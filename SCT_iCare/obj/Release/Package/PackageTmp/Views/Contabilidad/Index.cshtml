@*XLSX *@
<script type="text/javascript" src="https://unpkg.com/xlsx@0.15.1/dist/xlsx.full.min.js"></script>

@{
    GMIEntities db = new GMIEntities();
    var oUser = (Usuarios)HttpContext.Current.Session["User"];
    ViewBag.Title = "Index";

    int flag = 1;

    DateTime fechaInicio = DateTime.Today;
    DateTime fechaFinal = DateTime.Today.AddDays(1);

    string sucursal = "";
    string cuenta = null;
    string canal = "";
    string pago = "";
    string referido = "";
    string tipoReferido = "";
    string conciliado = null;
    string fila = "";

    string nombreExcel = "Conciliacion";

    if (ViewBag.FechaInicio != null)
    {
        fechaInicio = Convert.ToDateTime(ViewBag.FechaInicio);
    }

    if (ViewBag.FechaFinal != null)
    {
        fechaFinal = Convert.ToDateTime(ViewBag.FechaFinal);
        fechaFinal = fechaFinal.AddDays(1);
    }

    //Query TABLA

    var modelo = db.Paciente.Join(db.Cita, n => n.idPaciente, m => m.idPaciente, (n, m) => new { N = n, M = m }).
        Join(db.Captura, a => a.M.idPaciente, b => b.idPaciente, (a, b) => new { A = a, B = b }).
        Where(s => s.A.M.FechaCita >= fechaInicio && s.A.M.FechaCita < fechaFinal && s.B.EstatusCaptura == "Terminado" && s.A.M.Asistencia == null
        && s.A.M.Asistencia == null && s.A.M.TipoTramite != "REVALORACIÓN").OrderBy(o => o.A.M.Cuenta);

    var modelo1 = db.PacienteESP.
        Where(s => s.ReferidoPor.Contains(referido) && s.CanalTipo.Contains(tipoReferido) && s.FechaCaptura >= fechaInicio && s.FechaCaptura < fechaFinal && s.EstatusCaptura == "Terminado"
        && s.TipoTramite != "REVALORACIÓN" && s.Asistencia == null).OrderBy(o => o.Cuenta);


    var modeloExcel = db.Paciente.Join(db.Cita, n => n.idPaciente, m => m.idPaciente, (n, m) => new { N = n, M = m }).
        Join(db.Captura, a => a.M.idPaciente, b => b.idPaciente, (a, b) => new { A = a, B = b }).
        Where(s => s.A.M.FechaCita >= fechaInicio && s.A.M.FechaCita < fechaFinal && s.B.EstatusCaptura == "Terminado" && s.A.M.Asistencia == null
        && s.A.M.Asistencia == null && s.A.M.TipoTramite != "REVALORACIÓN").OrderBy(o => o.A.M.Cuenta);

    var modeloExcel1 = db.PacienteESP.
        Where(s => s.ReferidoPor.Contains(referido) && s.CanalTipo.Contains(tipoReferido) && s.FechaCaptura >= fechaInicio && s.FechaCaptura < fechaFinal && s.EstatusCaptura == "Terminado"
        && s.TipoTramite != "REVALORACIÓN" && s.Asistencia == null).OrderBy(o => o.Cuenta);


    //QUERY PARA BOTONES

    if (ViewBag.Conciliados == true)
    {
        modelo = db.Paciente.Join(db.Cita, n => n.idPaciente, m => m.idPaciente, (n, m) => new { N = n, M = m }).
    Join(db.Captura, a => a.M.idPaciente, b => b.idPaciente, (a, b) => new { A = a, B = b }).
    Where(s => s.A.M.FechaCita >= fechaInicio && s.A.M.FechaCita < fechaFinal && s.B.EstatusCaptura == "Terminado" && s.A.M.Asistencia == null
    && s.A.M.Asistencia == null && s.A.M.TipoTramite != "REVALORACIÓN" && s.A.M.Conciliado != null).OrderBy(o => o.A.M.Cuenta);


        modelo1 = db.PacienteESP.
   Where(s => s.ReferidoPor.Contains(referido) && s.CanalTipo.Contains(tipoReferido) && s.FechaCaptura >= fechaInicio && s.FechaCaptura < fechaFinal && s.EstatusCaptura == "Terminado"
   && s.TipoTramite != "REVALORACIÓN" && s.Asistencia == null && s.Conciliado != null).OrderBy(o => o.Cuenta);


        modeloExcel = db.Paciente.Join(db.Cita, n => n.idPaciente, m => m.idPaciente, (n, m) => new { N = n, M = m }).
           Join(db.Captura, a => a.M.idPaciente, b => b.idPaciente, (a, b) => new { A = a, B = b }).
           Where(s => s.A.M.FechaCita >= fechaInicio && s.A.M.FechaCita < fechaFinal && s.B.EstatusCaptura == "Terminado" && s.A.M.Asistencia == null
           && s.A.M.Asistencia == null && s.A.M.TipoTramite != "REVALORACIÓN" && s.A.M.Conciliado != null).OrderBy(o => o.A.M.Cuenta);

        modeloExcel1 = db.PacienteESP.
           Where(s => s.ReferidoPor.Contains(referido) && s.CanalTipo.Contains(tipoReferido) && s.FechaCaptura >= fechaInicio && s.FechaCaptura < fechaFinal && s.EstatusCaptura == "Terminado"
           && s.TipoTramite != "REVALORACIÓN" && s.Asistencia == null && s.Conciliado != null).OrderBy(o => o.Cuenta);

    }
    else if (ViewBag.NoConciliados == true)
    {
        modelo = db.Paciente.Join(db.Cita, n => n.idPaciente, m => m.idPaciente, (n, m) => new { N = n, M = m }).
Join(db.Captura, a => a.M.idPaciente, b => b.idPaciente, (a, b) => new { A = a, B = b }).
Where(s => s.A.M.FechaCita >= fechaInicio && s.A.M.FechaCita < fechaFinal && s.B.EstatusCaptura == "Terminado" && s.A.M.Asistencia == null
&& s.A.M.Asistencia == null && s.A.M.TipoTramite != "REVALORACIÓN" && s.A.M.Conciliado == null).OrderBy(o => o.A.M.Cuenta);


        modelo1 = db.PacienteESP.
           Where(s => s.ReferidoPor.Contains(referido) && s.CanalTipo.Contains(tipoReferido) && s.FechaCaptura >= fechaInicio && s.FechaCaptura < fechaFinal && s.EstatusCaptura == "Terminado"
           && s.TipoTramite != "REVALORACIÓN" && s.Asistencia == null && s.Conciliado == null).OrderBy(o => o.Cuenta);


        modeloExcel = db.Paciente.Join(db.Cita, n => n.idPaciente, m => m.idPaciente, (n, m) => new { N = n, M = m }).
           Join(db.Captura, a => a.M.idPaciente, b => b.idPaciente, (a, b) => new { A = a, B = b }).
           Where(s => s.A.M.FechaCita >= fechaInicio && s.A.M.FechaCita < fechaFinal && s.B.EstatusCaptura == "Terminado" && s.A.M.Asistencia == null
           && s.A.M.Asistencia == null && s.A.M.TipoTramite != "REVALORACIÓN" && s.A.M.Conciliado == null).OrderBy(o => o.A.M.Cuenta);

        modeloExcel1 = db.PacienteESP.
           Where(s => s.ReferidoPor.Contains(referido) && s.CanalTipo.Contains(tipoReferido) && s.FechaCaptura >= fechaInicio && s.FechaCaptura < fechaFinal && s.EstatusCaptura == "Terminado"
           && s.TipoTramite != "REVALORACIÓN" && s.Asistencia == null && s.Conciliado == null).OrderBy(o => o.Cuenta);


    }


    //FILTRO CONCILIADOS Y NO CONCILIADOS

    if (ViewBag.Conciliado == "CONCILIADOS")
    {
        conciliado = ViewBag.Conciliado;

        nombreExcel += "-" + conciliado;

        modelo = modelo.Where(w => w.A.M.Conciliado != null && (w.A.M.Cuenta == "BANCOS" || w.A.M.Cuenta == "CONEKTA")).OrderBy(o => o.A.M.Cuenta);
        modelo1 = modelo1.Where(w => w.Conciliado != null && (w.Cuenta == "BANCOS" || w.Cuenta == "CONEKTA")).OrderBy(o => o.Cuenta);
        modeloExcel = modeloExcel.Where(w => w.A.M.Conciliado != null && (w.A.M.Cuenta == "BANCOS" || w.A.M.Cuenta == "CONEKTA")).OrderBy(o => o.A.M.Cuenta);
        modeloExcel1 = modeloExcel1.Where(w => w.Conciliado != null && (w.Cuenta == "BANCOS" || w.Cuenta == "CONEKTA")).OrderBy(o => o.Cuenta);

    }

    else if (ViewBag.Conciliado == "NO CONCILIADOS")
    {
        conciliado = ViewBag.Conciliado;

        nombreExcel += "-" + conciliado;

        modelo = modelo.Where(w => w.A.M.Conciliado == null || (w.A.M.Cuenta != "BANCOS" && w.A.M.Cuenta != "CONEKTA")).OrderBy(o => o.A.M.Cuenta);
        modelo1 = modelo1.Where(w => w.Conciliado == null || (w.Cuenta != "BANCOS" && w.Cuenta != "CONEKTA")).OrderBy(o => o.Cuenta);
        modeloExcel = modeloExcel.Where(w => w.A.M.Conciliado == null || (w.A.M.Cuenta != "BANCOS" && w.A.M.Cuenta != "CONEKTA")).OrderBy(o => o.A.M.Cuenta);
        modeloExcel1 = modeloExcel1.Where(w => w.Conciliado == null || (w.Cuenta != "BANCOS" && w.Cuenta != "CONEKTA")).OrderBy(o => o.Cuenta);

    }

    else

    {
        conciliado = ViewBag.Conciliado;

        nombreExcel += "-" + conciliado;

        modelo = modelo.OrderBy(o => o.A.M.Cuenta);
        modelo1 = modelo1.OrderBy(o => o.Cuenta);
        modeloExcel = modeloExcel.OrderBy(o => o.A.M.Cuenta);
        modeloExcel1 = modeloExcel1.OrderBy(o => o.Cuenta);

    }


    //FILTROS EN GENERAL

    if (ViewBag.Sucursal != "")
    {
        sucursal = ViewBag.Sucursal;

        nombreExcel += "-" + sucursal;

        modelo = modelo.Where(w => w.A.M.Sucursal.Contains(sucursal)).OrderBy(o => o.A.M.Cuenta);
        modelo1 = modelo1.Where(w => w.Sucursal.Contains(sucursal)).OrderBy(o => o.Cuenta);
        modeloExcel = modeloExcel.Where(w => w.A.M.Sucursal.Contains(sucursal)).OrderBy(o => o.A.M.Cuenta);
        modeloExcel1 = modeloExcel1.Where(w => w.Sucursal.Contains(sucursal)).OrderBy(o => o.Cuenta);

    }

    if (ViewBag.Canal != "")
    {
        canal = ViewBag.Canal;

        nombreExcel += "-" + canal;

        modelo = modelo.Where(w => w.A.M.CanalTipo.Contains(canal)).OrderBy(o => o.A.M.Cuenta);
        modelo1 = modelo1.Where(w => w.CanalTipo.Contains(canal)).OrderBy(o => o.Cuenta);
        modeloExcel = modeloExcel.Where(w => w.A.M.CanalTipo.Contains(canal)).OrderBy(o => o.A.M.Cuenta);
        modeloExcel1 = modeloExcel1.Where(w => w.CanalTipo.Contains(canal)).OrderBy(o => o.Cuenta);
    }

    if (ViewBag.Pago != "" && ViewBag.Pago != "BAJIO")
    {
        pago = ViewBag.Pago;

        nombreExcel += "-" + pago;

        modelo = modelo.Where(w => w.A.M.TipoPago.Contains(pago)).OrderBy(o => o.A.M.Cuenta);
        modelo1 = modelo1.Where(w => w.TipoPago.Contains(pago)).OrderBy(o => o.Cuenta);
        modeloExcel = modeloExcel.Where(w => w.A.M.TipoPago.Contains(pago)).OrderBy(o => o.A.M.Cuenta);
        modeloExcel1 = modeloExcel1.Where(w => w.TipoPago.Contains(pago)).OrderBy(o => o.Cuenta);
    }

    else if (ViewBag.Pago == "BAJIO")
    {
        pago = ViewBag.Pago;

        nombreExcel += "-" + pago;

        modelo = modelo.Where(w => (w.A.M.TipoPago == "Referencia BanBajío" || w.A.M.TipoPago == "Referencía BanBajío" || w.A.M.TipoPago == "Transferencia vía BanBajío")).OrderBy(o => o.A.M.Cuenta);
        modelo1 = modelo1.Where(w => (w.TipoPago == "Referencia BanBajío" || w.TipoPago == "Referencía BanBajío" || w.TipoPago == "Transferencia vía BanBajío")).OrderBy(o => o.Cuenta);
        modeloExcel = modeloExcel.Where(w => (w.A.M.TipoPago == "Referencia BanBajío" || w.A.M.TipoPago == "Referencía BanBajío" || w.A.M.TipoPago == "Transferencia vía BanBajío")).OrderBy(o => o.A.M.Cuenta);
        modeloExcel1 = modeloExcel1.Where(w => (w.TipoPago == "Referencia BanBajío" || w.TipoPago == "Referencía BanBajío" || w.TipoPago == "Transferencia vía BanBajío")).OrderBy(o => o.Cuenta);
    }

    int idReferido = ViewBag.idReferido;

    if (ViewBag.Referido != "" && ViewBag.idReferido != 0)
    {
        referido = ViewBag.Referido;

        nombreExcel += "-" + referido;

        modelo = modelo.Where(w => w.A.M.ReferidoPor.Contains(referido)).OrderBy(o => o.A.M.Cuenta);
        modelo1 = modelo1.Where(w => w.ReferidoPor.Contains(referido)).OrderBy(o => o.Cuenta);
        modeloExcel = modeloExcel.Where(w => w.A.M.ReferidoPor.Contains(referido)).OrderBy(o => o.A.M.Cuenta);
        modeloExcel1 = modeloExcel1.Where(w => w.ReferidoPor.Contains(referido)).OrderBy(o => o.Cuenta);

        var Tipo = (from i in db.Referido where i.idReferido == idReferido select i).FirstOrDefault();
        tipoReferido = Tipo.Tipo;
    }



    if (ViewBag.Cuenta != "" && ViewBag.Cuenta != null)
    {
        cuenta = ViewBag.Cuenta;
        nombreExcel = ViewBag.Cuenta;

        nombreExcel += "-" + cuenta;

        modelo = modelo.Where(w => w.A.M.Cuenta.Contains(cuenta)).OrderBy(o => o.A.M.Cuenta);
        modelo1 = modelo1.Where(w => w.Cuenta.Contains(cuenta)).OrderBy(o => o.Cuenta);
        modeloExcel = modeloExcel.Where(w => w.A.M.Cuenta.Contains(cuenta)).OrderBy(o => o.A.M.Cuenta);
        modeloExcel1 = modeloExcel1.Where(w => w.Cuenta.Contains(cuenta)).OrderBy(o => o.Cuenta);
    }
    if (ViewBag.Cuenta == null)
    {
        cuenta = ViewBag.Cuenta;
        nombreExcel = ViewBag.Cuenta;

        nombreExcel += "-" + cuenta;

        modelo = modelo.Where(w => w.A.M.Cuenta == null).OrderBy(o => o.A.M.Cuenta);
        modelo1 = modelo1.Where(w => w.Cuenta == null).OrderBy(o => o.Cuenta);
        modeloExcel = modeloExcel.Where(w => w.A.M.Cuenta==null).OrderBy(o => o.A.M.Cuenta);
        modeloExcel1 = modeloExcel1.Where(w => w.Cuenta==null).OrderBy(o => o.Cuenta);
    }

    //if(ViewBag.Cuenta == "TODOS")
    //{
    //    cuenta = "";
    //    sucursal = "";
    //}

    //if (ViewBag.Cuenta == "TODOS")
    //{
    //    modelo = db.Paciente.Join(db.Cita, n => n.Folio, m => m.Folio, (n, m) => new { N = n, M = m }).Where(s => s.M.FechaReferencia >= fechaInicio && s.M.FechaReferencia < fechaFinal && s.M.TipoTramite != "REVALORACIÓN" && s.M.Asistencia == null);
    //    modelo1 = db.PacienteESP.Where(s => s.FechaCaptura >= fechaInicio && s.FechaCaptura < fechaFinal && s.Asistencia == null && s.TipoTramite != "REVALORACIÓN");
    //    modeloExcel = db.Paciente.Join(db.Cita, n => n.Folio, m => m.Folio, (n, m) => new { N = n, M = m }).Where(s => s.M.FechaReferencia >= fechaInicio && s.M.FechaReferencia < fechaFinal && s.M.TipoTramite != "REVALORACIÓN" && s.M.Asistencia == null);
    //    modeloExcel1 = db.PacienteESP.Where(s => s.FechaCaptura >= fechaInicio && s.FechaCaptura < fechaFinal && s.Asistencia == null && s.TipoTramite != "REVALORACIÓN");
    //    cuenta = "TODOS";
    //}

}

<br />
<h2 style="color: white">Conciliación</h2>
<br />

<form class="form-inline" method="post" enctype="multipart/form-data" action="@Url.Content("~/Contabilidad/Index")">
    <div>
        <select name="Conciliadooo" style="font-size: 1.5vh; width: 125px" class="btn btn-info dropdown-toggle">
            @{
                if (ViewBag.Conciliado == "" || ViewBag.Conciliado == null)
                {
                    <option value="">EPIS GENERAL</option>
                }
                else
                {
                    <option value="@conciliado">@conciliado</option>
                }
                <option value="CONCILIADOS">EPIS CONCILIADOS</option>
                <option value="NO CONCILIADOS">EPIS NO CONCILIADOS</option>
                <option class="dropdown-item" value="">TODOS</option>
            }

        </select>

        <select name="sucursal" style="font-size: 1.5vh; width: 110px" class="form-control">
            @{
                if (ViewBag.Sucursal == "")
                {
                    <option value="">SUCURSAL</option>
                }
                else
                {
                    <option value="@sucursal">@sucursal</option>
                }
            }

            @{
                foreach (var item in db.Sucursales.Where(w => w.Nombre != "IN SITU"))
                {
                    <option value="@item.Nombre">@item.Nombre</option>
                }
            }
            <option value="">TODOS</option>
        </select>

        <select name="cuenta" style="font-size: 1.5vh; width: 100px" class="form-control">
            @{
                if (ViewBag.Cuenta == "")
                {
                    <option value="">CUENTA</option>
                }
                else if (ViewBag.Cuenta == null)
                {
                    <option value="@cuenta">CAJA</option>
                }
                else
                {
                    <option value="@cuenta"> @cuenta.ToUpper() </option>
                }
            }
            <option value="NULL">CAJA</option>
            <option value="BANCOS">BANCOS</option>
            <option value="CONEKTA">CONEKTA</option>
            <option value="ANTICIPOS">ANTICIPOS</option>
            <option value="CUENTAS X COBRAR">CUENTAS X COBRAR</option>
            <option value="CORPORATIVO">CORPORATIVO</option>
            <option value="ACLARACIONES">ACLARACIONES</option>
            <option value="ACLARACIONES_RESUELTAS">ACLARACIONES RESUELTAS</option>
            <option value="DEVOLUCIONES">DEVOLUCIONES</option>
            <option value="">TODOS</option>
        </select>

        <select name="canal" style="font-size:1.5vh; width: 100px" class="form-control">
            @{
                if (ViewBag.Canal == "")
                {
                    <option value="">CANAL</option>
                }
                else
                {
                    <option value="@canal">@canal.ToUpper()</option>
                }
            }
            @{
                foreach (var item in db.Canales)
                {
                    <option value="@item.NombreCanal">@item.NombreCanal</option>
                }
            }
            <option value="">TODOS</option>
        </select>

        <select name="tipoPago" style="font-size: 1.5vh; width: 120px" class="form-control">
            @{
                if (ViewBag.Pago == "" || ViewBag.Pago == null)
                {
                    <option value="">TIPO DE PAGO</option>
                }
                else
                {
                    <option value="@pago">@pago</option>
                }
            }
            <option value="Referencia OXXO">Referencia OXXO</option>
            <option value="BAJIO">Bajio</option>
            <option value="BanCoppel TLS">BanCoppel TLS</option>
            <option value="BanCoppel LC">BanCoppel LC</option>
            <option value="Banco Azteca TLS">Banco Azteca TLS</option>
            <option value="Banco Azteca LC">Banco Azteca LC</option>
            <option value="Banorte">Banorte</option>
            <option value="Santander">Santander</option>
            <option value="Cuenta Externa">Cuenta Externa</option>
            <option value="Pendiente de Pago">Pendiente de Pago</option>
            <option value="">TODOS</option>
        </select>

        <select name="referido" style="font-size: 1.5vh; width: 130px" class="form-control">
                      @{
                if (ViewBag.Referido == "" || ViewBag.Referido == null)
                {
                    <option value="">REFERIDO POR</option>
                }
                else
                {
                    var refe = db.Referido.Where(s => s.Nombre == referido).FirstOrDefault();

                    <option value="@refe.idReferido">@referido.ToUpper()</option>
                }
            }
            @foreach (var item in db.Referido.OrderBy(o => o.Tipo).ThenBy(o => o.Nombre))
            {
                <option value="@item.idReferido">@item.Nombre -- @item.Tipo</option>
            }
            @foreach (var item in db.Referido.OrderBy(o => o.Tipo).ThenBy(o => o.Nombre))
            {
                <option value="@item.idReferido">@item.Nombre -- @item.Tipo</option>
            }
            <option value="">TODOS</option>
        </select>

        @{

            DateTime ViewBagFechaInicio = Convert.ToDateTime(ViewBag.fechaInicio);
            var SetFechaInicio = ViewBagFechaInicio.Date.ToString("yyyy-MM-dd");

            if (ViewBag.fechaInicio != null)
            {

                <input type="date" name="fechaInicio" class="form-control" value="@SetFechaInicio" style="width: 140px;" />

            }

            else

            {

                <input type="date" name="fechaInicio" class="form-control" value="" style="width: 140px;" />

            }

        }

        @{

            DateTime ViewBagFechaFinal = Convert.ToDateTime(ViewBag.fechaFinal);
            var SetFechaFinal = ViewBagFechaFinal.Date.ToString("yyyy-MM-dd");

            if (ViewBag.fechaFinal != null)
            {

                <input type="date" name="fechaFinal" class="form-control" value="@SetFechaFinal" style="width: 140px;" />

            }

            else

            {

                <input type="date" name="fechaFinal" class="form-control" value="" style="width: 140px;" />

            }

        }



        <input type="submit" class="btn btn-info" value="Enviar" />
        <a href="~/Contabilidad/Index">
            <span type="button" class="btn btn-success">Limpiar</span>
        </a>

    </div>
    <br />


</form>

<script>

    function ExportToExcel(type, fn, dl)
    {
        var elt = document.getElementById('tbl_exporttable_to_xls');
        var wb = XLSX.utils.table_to_book(elt, { sheet: "sheet1" });
        return dl ?
            XLSX.write(wb, { bookType: type, bookSST: true, type: 'base64' }) :
            XLSX.writeFile(wb, fn || ('@nombreExcel' + ' del @Convert.ToDateTime(fechaInicio).ToString("dd-MM-yy")' + ' al @Convert.ToDateTime(fechaFinal).AddDays(-1).ToString("dd-MM-yy").' + (type || 'xlsx')));
    }

</script>





<div>
    <button style="background-color:limegreen" class="btn btn-info dropdown-toggle" onclick="ExportToExcel('xlsx')">Exportar Datos a XLSX</button>

    @*<a style="background-color:Highlight" class="btn btn-info dropdown-toggle" href="/Contabilidad/Index">General</a>
        <a style="background-color:forestgreen" class="btn btn-info dropdown-toggle" href="/Contabilidad/Index/1">Conciliados</a>
        <a style="background-color:red" class="btn btn-info dropdown-toggle" href="/Contabilidad/Index/2">No conciliados</a>*@

</div>

@*TABLA NORMAL*@
<br />
<div class="tablaScroll" style="min-height: 1000px; min-width: 1000px">
    <table class="table  table-hover tablas" style="color: #000000">
        <thead style="color:white">
            <tr>
                <th></th>
                <th>
                    Nombre
                </th>
                <th>
                    Sucursal
                </th>
                <th>
                    Referencia
                </th><!--Referido Por(vía y canal), Tipo de pago (Conekta, BanBajio, Banco Alternativo) / Fecha de pago-->
                <th>
                    ReferidoPor
                </th>
                <th>
                    Cuenta
                </th>
                <th>
                    TipoPago
                </th>
                <th>
                    FechaEjecución
                </th>
                <th>
                    FechaPago
                </th>
                <th>
                    Precio
                </th>
                <th>
                    Usuario
                </th>
                <th></th>
            </tr>
        </thead>

        @{
            foreach (var item in modelo.OrderBy(o => o.A.M.FechaCita))
            {
                if (item.A.M.TipoLicencia == "AEREO" || item.A.M.TipoLicencia == "AEREO_PISTA")
                {
                    fila = "#D1C4E9";
                }
                else
                {
                    fila = "white";
                }
                <tr style="background-color:@fila">
                    <td>
                        @flag
                    </td>
                    <td style="font-size:smaller">
                        @{
                            string[] historico = item.A.M.CuentaComentario != null ? item.A.M.CuentaComentario.Split('+') : null;
                            int flag0 = 1;

                            if (item.A.M.CuentaComentario == null)
                            {
                                <b>@item.A.N.Nombre</b>
                            }
                            else
                            {
                                <span class="field-tip">
                                    <b>@item.A.N.Nombre</b>
                                    <span class="tip-content">
                                        @{
                                            foreach (var i in historico)
                                            {
                                                <span>@flag0 @i</span><br />
                                                flag0++;
                                            }
                                        }
                                    </span>
                                </span>
                            }
                        }
                    </td>
                    <td style="font-size:smaller">
                        @*@item.A.M.Sucursal*@
                        <b><mark style="background; padding:5px; border-radius:7px"><span class=""></span>   @item.A.M.Sucursal </mark></b>
                    </td>
                    @{
                        var ticketPaciente = (from i in db.Tickets where i.idPaciente == item.A.M.idPaciente select i.idTicket).FirstOrDefault();
                        string referidoFinal = Convert.ToString(idReferido);
                        DateTime fechaFinalConc = DateTime.Today;
                        string fechaFinalConcStr = Convert.ToString(fechaFinalConc);
                        if (ViewBag.fechafinal != null)
                        {
                            fechaFinalConcStr = SetFechaFinal;
                        }
                        if (idReferido == 0)
                        {
                            referidoFinal = "";
                        }
                        <td style="font-size:smaller">
                            <a href=@Url.Action("AbrirTicket", "Contabilidad", new { idTicket = ticketPaciente, cuenta = cuenta, canal = canal, sucursal = sucursal,  tiporeferido = referidoFinal, tipopago = pago, fechaInicio = fechaInicio, fechaFinal = fechaFinalConcStr}) style="color:navy; text-decoration:none"><span>@item.A.M.Referencia</span></a>
                        </td>
                    }
                    <td style="font-size:smaller">
                        <span class="field-tip">
                            <b>@item.A.M.ReferidoPor</b>
                            <span class="tip-content">
                                CANAL: @item.A.M.CanalTipo
                            </span>
                        </span>
                    </td>
                    <td style="font-size:smaller">
                        @{
                            if (item.A.M.Cuenta == null)
                            {
                                <span>Caja</span>
                            }
                            else
                            {
                                <span>@item.A.M.Cuenta</span>
                            }
                        }
                    </td>
                    <td>
                        @{
                            if (item.A.M.TipoPago == "Referencia OXXO" || item.A.M.TipoPago == "Pago con Tarjeta")
                            {
                                <span>Conekta</span>
                            }
                            else if (item.A.M.TipoPago == "Referencía BanBajío" || item.A.M.TipoPago == "Transferencia vía BanBajío" || item.A.M.TipoPago == "Referencia BanBajío")
                            {
                                <span>BanBajío</span>
                            }
                            else if (item.A.M.TipoPago == "Pendiente de Pago")
                            {
                                <span>Pendiente</span>
                            }
                            else
                            {
                                <span>@item.A.M.TipoPago</span>
                            }
                        }
                    </td>
                    <td>
                        @Convert.ToDateTime(item.A.M.FechaCita).ToString("dd-MM-yy")
                    </td>
                    <td>
                        <span class="field-tip">
                            @{
                                if (item.A.M.Cuenta == "BANCOS" || item.A.M.Cuenta == "CONEKTA")
                                {
                                    @Convert.ToDateTime(item.A.M.FechaContable).ToString("dd-MM-yy")
                                }

                                else
                                {
                                    <span><mark style="background-color: #FFFF00; padding:5px; border-radius:7px">---------</mark></span>

                                }
                            }
                            <span class="tip-content">

                                @{
                                    if (item.A.M.FechaContable != null)
                                    {
                                        <span class="tip-content">
                                        <b>Ultimo Movimiento Contable:</b>
                                        <b>@Convert.ToDateTime(item.A.M.FechaContable).ToString("dd-MMMM-yy")</b>
                                        </span>
                                    }

                                    else
                                    {
                                        <span class="tip-content">
                                            <b>No hay Movimientos Contables</b>
                                        </span>
                                    }
                                }

                            </span>
                        </span>
                    </td>
                    <td>
                        @{

                            //OPCION CON PRECIO EN TABLA CAPTURA
                            var costo = (from i in db.Cita where i.idPaciente == item.A.M.idPaciente select i).FirstOrDefault();

                            <span><b>$@costo.PrecioEpi</b></span>
                        }

                    </td>
                    <td style="font-size:smaller">
                        @item.A.M.Recepcionista
                    </td>
                    <td>
                        <div class="btn-group">

                            @{
                                if(oUser.Nombre != "Maribel Hernandez")
                                { 

                                    if (oUser.idRol == 2 || oUser.Nombre == "José Luis Mora" || oUser.Nombre == "Jessica Bustos" || oUser.Nombre == "Teresa Lozano " || oUser.Nombre == "Ramon Reyna")
                                    {
                                        <button type="button" class="btn btn-info dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            Acciones <span class="glyphicon glyphicon-triangle-bottom"></span>
                                        </button>

                                        <div class="dropdown-menu" style="padding:10px">
                                            @*@{
                                                var consultaTicket = (from i in db.Tickets where i.idPaciente == item.A.M.idPaciente select i.idTicket).FirstOrDefault();

                                                if (consultaTicket != 0)
                                                {
                                                    <b>@Html.ActionLink("Ticket de Pago", "AbrirTicket", new { id = consultaTicket }, new { style = "color: crimson; text-decoration: none" })</b>
                                                }
                                            }*@
                                            <a href="#" data-toggle="modal" data-target="#Prueba_@item.A.M.idCita"><b style="color:red">Abrir Ticket</b></a>
                                            <div class="dropdown-divider"></div>
                                            <a href="#" data-toggle="modal" data-target="#Efectivo_@item.A.M.idCita"><b>Bancos</b></a>
                                            <div class="dropdown-divider"></div>
                                            <a href="#" data-toggle="modal" data-target="#Conekta_@item.A.M.idCita"><b>Conekta</b></a>
                                            <div class="dropdown-divider"></div>
                                            <a href="#" data-toggle="modal" data-target="#Anticipos_@item.A.M.idCita"><b>Anticipos</b></a>
                                            <div class="dropdown-divider"></div>
                                            <a href="#" data-toggle="modal" data-target="#CXC_@item.A.M.idCita"><b>CuentasXCobrar</b></a>
                                            <div class="dropdown-divider"></div>
                                            @*<a href="#" data-toggle="modal" data-target="#Corporativo_@item.A.M.idCita"><b>Corporativo</b></a>
                                             <div class="dropdown-divider"></div>*@
                                            @{
                                                if (item.A.M.Cuenta != "ACLARACIONES")
                                                    {
                                                        <a href="#" data-toggle="modal" data-target="#Aclaracion_@item.A.M.idCita"><b>Aclaracion</b></a>
                                                        <div class="dropdown-divider"></div>
                                                    }
                                                }

                                            @{
                                                if (oUser.idRol == 2 || oUser.Nombre == "Flavio Rodrigo")
                                                {
                                                    if (item.A.M.Cuenta == "ACLARACIONES")
                                                    {
                                                        <a href="#" data-toggle="modal" data-target="#Aclaraciones_Resueltas_@item.A.M.idCita"><b>Aclaraciones Resueltas</b></a>
                                                        <div class="dropdown-divider"></div>
                                                    }
                                                }
                                            }
                                            <a href="#" data-toggle="modal" data-target="#Devoluciones_@item.A.M.idCita"><b>Devoluciones</b></a>
                                            <div class="dropdown-divider"></div>
                                            @*<a href="#" data-toggle="modal" data-target="#CONCILIADO_@item.A.M.idPaciente"><b>CONCILIADO</b></a>
                                                       <div class="dropdown-divider"></div>*@
                                        </div>
                                    }

                                    else if (item.A.M.Conciliado != null && (item.A.M.Cuenta == "BANCOS" || item.A.M.Cuenta == "CONEKTA"))
                                    {
                                        <b style="font-size:x-small">CONCILIADO </b><span class="glyphicon glyphicon-ok" style="font-size:x-small"></span>
                                    }

                                    else
                                    {
                                        <button type="button" class="btn btn-info dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            Acciones <span class="glyphicon glyphicon-triangle-bottom"></span>
                                        </button>

                                        <div class="dropdown-menu" style="padding:10px">
                                            @*@{
                                            var consultaTicket = (from i in db.Tickets where i.idPaciente == item.A.M.idPaciente select i.idTicket).FirstOrDefault();

                                            if (consultaTicket != 0)
                                            {
                                                <b>@Html.ActionLink("Ticket de Pago", "AbrirTicket", new { id = consultaTicket }, new { style = "color: crimson; text-decoration: none" })</b>
                                            }
                                                }*@
                                            <a href="#" data-toggle="modal" data-target="#Prueba_@item.A.M.idCita"><b style="color:red">Abrir Ticket</b></a>
                                            <div class="dropdown-divider"></div>
                                            <a href="#" data-toggle="modal" data-target="#Efectivo_@item.A.M.idCita"><b>Bancos</b></a>
                                            <div class="dropdown-divider"></div>
                                            <a href="#" data-toggle="modal" data-target="#Conekta_@item.A.M.idCita"><b>Conekta</b></a>
                                            <div class="dropdown-divider"></div>
                                            <a href="#" data-toggle="modal" data-target="#Anticipos_@item.A.M.idCita"><b>Anticipos</b></a>
                                            <div class="dropdown-divider"></div>
                                            <a href="#" data-toggle="modal" data-target="#CXC_@item.A.M.idCita"><b>CuentasXCobrar</b></a>
                                            <div class="dropdown-divider"></div>
                                            @*<a href="#" data-toggle="modal" data-target="#Corporativo_@item.A.M.idCita"><b>Corporativo</b></a>
                                            <div class="dropdown-divider"></div>*@
                                            <a href="#" data-toggle="modal" data-target="#Aclaracion_@item.A.M.idCita"><b>Aclaracion</b></a>
                                            <div class="dropdown-divider"></div>
                                            <a href="#" data-toggle="modal" data-target="#Devoluciones_@item.A.M.idCita"><b>Devoluciones</b></a>
                                            <div class="dropdown-divider"></div>
                                            @*<a href="#" data-toggle="modal" data-target="#CONCILIADO_@item.A.M.idPaciente"><b>CONCILIADO</b></a>
                                             <div class="dropdown-divider"></div>*@

                                        </div>
                                    }
                                }
                            }

                            <!-- Ticket de Pago -->
                            <form method="post" enctype="multipart/form-data" action="@Url.Content("~/Contabilidad/AbrirTicket")">
                                @Html.AntiForgeryToken()
                                <div class="modal fade" id="Prueba_@item.A.M.idCita" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h4 class="modal-title" id="exampleModalLabel"><b>Informacion del Paciente</b></h4>
                                            </div>
                                            <div class="modal-body">
                                                <div class="form-group" style="width:60%; min-width:320px">
                                                    <label for="recipient-name" class="col-form-label">Nombre:</label>
                                                    <b>@item.A.N.Nombre</b><br />
                                                    <label for="recipient-name" class="col-form-label">CURP:</label>
                                                    <b>@item.A.N.CURP</b><br />
                                                    <label for="recipient-name" class="col-form-label">NoExpediente:</label>
                                                    <b>@item.A.M.NoExpediente</b><br />
                                                    <label for="recipient-name" class="col-form-label">Fecha:</label>
                                                    <b>@Convert.ToDateTime(item.A.M.FechaReferencia).ToString("dd-MMMM-yyyy")</b><br />
                                                    <label for="recipient-name" class="col-form-label">Sucursal:</label>
                                                    <b>@item.A.M.Sucursal</b><br />
                                                    <label for="recipient-name" class="col-form-label">Doctor:</label>
                                                    <b>@item.A.M.Doctor</b><br />
                                                    <input type="hidden" name="fechaInicio" value="@fechaInicio" />

                                                    @{

                                                        if (ViewBag.fechafinal != null)
                                                        {

                                                            <input type="hidden" name="fechaFinal" value="@SetFechaFinal" />

                                                        }

                                                        else
                                                        {

                                                            <input type="hidden" name="fechaFinal" value="@DateTime.Today" />


                                                        }

                                                    }
                                                    <input type="hidden" name="cuenta" value="@cuenta" />
                                                    <input type="hidden" name="canal" value="@canal" />
                                                    <input type="hidden" name="sucursal" value="@sucursal" />
                                                    @{
                                                        if (ViewBag.Pago == "" || ViewBag.Pago == null)
                                                        {
                                                            <input type="hidden" name="pago" value="" />
                                                        }
                                                        else
                                                        {
                                                            <input type="hidden" name="pago" value="@pago" />
                                                        }
                                                    }

                                                    @{
                                                        if (idReferido == 0)
                                                        {
                                                            <input type="hidden" name="tiporeferido" value="" />
                                                        }
                                                        else
                                                        {
                                                            <input type="hidden" name="tiporeferido" value="@idReferido" />
                                                        }
                                                    }
                                                    <input type="hidden" name="tipopago" value="@pago" />

                                                    @{
                                                        var consultaTicket = (from i in db.Tickets where i.idPaciente == item.A.M.idPaciente select i.idTicket).FirstOrDefault();

                                                        if (consultaTicket != 0)
                                                        {
                                                            <input type="hidden" name="idTicket" value="@consultaTicket" />
                                                        }
                                                    }
                                                </div>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                                                <input type="submit" value="Abrir Ticket" class="btn " style="background-color:red; color:aliceblue" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>

                            <!-- Efectivo -->
                            <form method="post" enctype="multipart/form-data" action="@Url.Content("~/Contabilidad/CambiarCuenta")">
                                @Html.AntiForgeryToken()
                                <div class="modal fade" id="Efectivo_@item.A.M.idCita" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h4 class="modal-title" id="exampleModalLabel"><b>¿Está seguro de mandar los datos de esta venta a BANCOS?</b></h4>
                                            </div>
                                            <div class="modal-body">
                                                <input type="hidden" name="id" value="@item.A.M.idCita" />
                                                <input type="hidden" name="cuenta" value="BANCOS" />
                                                <div class="form-group" style="width:60%; min-width:320px">
                                                    <label for="recipient-name" class="col-form-label">Nombre:</label>
                                                    <b>@item.A.N.Nombre</b><br />
                                                    <label for="recipient-name" class="col-form-label">CURP:</label>
                                                    <b>@item.A.N.CURP</b><br />
                                                    <label for="recipient-name" class="col-form-label">NoExpediente:</label>
                                                    <b>@item.A.M.NoExpediente</b><br />
                                                    <label for="recipient-name" class="col-form-label">Fecha:</label>
                                                    <b>@Convert.ToDateTime(item.A.M.FechaReferencia).ToString("dd-MMMM-yyyy")</b><br />
                                                    <label for="recipient-name" class="col-form-label">Sucursal:</label>
                                                    <b>@item.A.M.Sucursal</b><br />
                                                    <label for="recipient-name" class="col-form-label">Doctor:</label>
                                                    <b>@item.A.M.Doctor</b><br />
                                                    <label for="recipient-name" class="col-form-label">Tipo de Pago:</label>
                                                    <select required name="pago" style="width:100%; min-height:5vh; min-width:99%; font-size:2vh" class="form-select">
                                                        <option selected disabled>Seleccionar</option>
                                                        <option value="Referencía BanBajío">Referencía BanBajío</option>
                                                        <option value="Transferencia vía BanBajío">Transferencia vía BanBajío</option>
                                                        <option value="Banorte">Banorte</option>
                                                        <option value="Santander">Santander</option>
                                                        <option value="BanCoppel TLS">BanCoppel TLS</option>
                                                        <option value="BanCoppel LC">BanCoppel LC</option>
                                                        <option value="Banco Azteca TLS">Banco Azteca TLS</option>
                                                        <option value="Banco Azteca LC">Banco Azteca LC</option>
                                                        <option value="Cuenta Externa">Cuenta Externa</option>
                                                        <option value="Credito Empresas">Credito Empresas</option>
                                                    </select>
                                                    <br />

                                                    @*CAMPO REQUERIDO PARA SELECTORES*@
                                                    <br />
                                                    <div class="form-group" style="width:60%; min-width:320px">
                                                        <label for="recipient-name" class="form-select" required>Indique Forma de Pago</label>
                                                        <select name="FormadePago" style="width:100%; min-height:5vh; min-width:99%; font-size:2vh" class="form-control" required>
                                                            <option disabled selected value="">Seleccione una opcion</option>
                                                            <option value="EFECTIVO">Efectivo</option>
                                                            <option value="TRANSFERENCIA">Transferencia</option>
                                                            <option value="TARJETA">Tarjeta</option>
                                                        </select>
                                                    </div>

                                                    <label for="recipient-name" class="col-form-label">Fecha de pago contable:</label>
                                                    <input type="date" class="form-control" name="fechaContable" />
                                                    <label for="recipient-name" class="col-form-label">¿Desea agregar un comentario?:</label>
                                                    <input type="text" class="form-control" name="comentario" />
                                                    <input type="hidden" name="usuario" value="@oUser.Nombre" />
                                                    <input type="hidden" name="fechaInicio" value="@fechaInicio" />
                                                    @{

                                                        if (ViewBag.fechafinal != null)
                                                        {

                                                            <input type="hidden" name="fechaFinal" value="@SetFechaFinal" />

                                                        }

                                                        else
                                                        {

                                                            <input type="hidden" name="fechaFinal" value="@DateTime.Today" />


                                                        }

                                                    }
                                                    <input type="hidden" name="cuenta2" value="@cuenta" />
                                                    <input type="hidden" name="canal" value="@canal" />
                                                    <input type="hidden" name="sucursal" value="@sucursal" />
                                                    <input type="hidden" name="conciliado" value="@conciliado" />
                                                    @{
                                                        if (idReferido == 0)
                                                        {
                                                            <input type="hidden" name="idGestor" value="" />
                                                        }
                                                        else
                                                        {
                                                            <input type="hidden" name="idGestor" value="@idReferido" />
                                                        }
                                                    }
                                                </div>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                                                <input type="submit" value="Guardar" class="btn btn-primary" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>

                            <!-- Conekta -->
                            <form method="post" enctype="multipart/form-data" action="@Url.Content("~/Contabilidad/CambiarCuenta")">
                                @Html.AntiForgeryToken()
                                <div class="modal fade" id="Conekta_@item.A.M.idCita" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h4 class="modal-title" id="exampleModalLabel"><b>¿Está seguro de mandar los datos de esta venta a Conekta?</b></h4>
                                            </div>
                                            <div class="modal-body">
                                                <input type="hidden" name="id" value="@item.A.M.idCita" />
                                                <input type="hidden" name="cuenta" value="CONEKTA" />
                                                <div class="form-group" style="width:60%; min-width:320px">
                                                    <label for="recipient-name" class="col-form-label">Nombre:</label>
                                                    <b>@item.A.N.Nombre</b><br />
                                                    <label for="recipient-name" class="col-form-label">CURP:</label>
                                                    <b>@item.A.N.CURP</b><br />
                                                    <label for="recipient-name" class="col-form-label">NoExpediente:</label>
                                                    <b>@item.A.M.NoExpediente</b><br />
                                                    <label for="recipient-name" class="col-form-label">Fecha:</label>
                                                    <b>@Convert.ToDateTime(item.A.M.FechaReferencia).ToString("dd-MMMM-yyyy")</b><br />
                                                    <label for="recipient-name" class="col-form-label">Sucursal:</label>
                                                    <b>@item.A.M.Sucursal</b><br />
                                                    <label for="recipient-name" class="col-form-label">Doctor:</label>
                                                    <b>@item.A.M.Doctor</b><br />
                                                    <label for="recipient-name" class="col-form-label">Tipo de Pago:</label>
                                                    <select required name="pago" style="width:100%; min-height:5vh; min-width:99%; font-size:2vh" class="form-select">
                                                        <option selected disabled>Seleccionar</option>
                                                        <option value="Referencia OXXO">Referencia OXXO</option>
                                                        <option value="Pago con Tarjeta">Pago con Tarjeta</option>
                                                    </select>
                                                    <br />
                                                    <label for="recipient-name" class="col-form-label">Fecha de pago contable:</label>
                                                    <input type="date" class="form-control" name="fechaContable" />
                                                    <label for="recipient-name" class="col-form-label">¿Desea agregar un comentario?:</label>
                                                    <input type="text" class="form-control" name="comentario" />
                                                    <input type="hidden" name="usuario" value="@oUser.Nombre" />
                                                    <input type="hidden" name="fechaInicio" value="@fechaInicio" />
                                                    @{

                                                        if (ViewBag.fechafinal != null)
                                                        {

                                                            <input type="hidden" name="fechaFinal" value="@SetFechaFinal" />

                                                        }

                                                        else
                                                        {

                                                            <input type="hidden" name="fechaFinal" value="@DateTime.Today" />


                                                        }

                                                    }
                                                    <input type="hidden" name="cuenta2" value="@cuenta" />
                                                    <input type="hidden" name="canal" value="@canal" />
                                                    <input type="hidden" name="sucursal" value="@sucursal" />
                                                </div>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                                                <input type="submit" value="Guardar" class="btn btn-primary" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>

                            <!-- ANTICIPOS -->
                            <form method="post" enctype="multipart/form-data" action="@Url.Content("~/Contabilidad/CambiarCuenta")">
                                @Html.AntiForgeryToken()
                                <div class="modal fade" id="Anticipos_@item.A.M.idCita" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h4 class="modal-title" id="exampleModalLabel"><b>¿Está seguro de mandar los datos de esta venta a ANTICIPOS?</b></h4>
                                            </div>
                                            <div class="modal-body">
                                                <input type="hidden" name="id" value="@item.A.M.idCita" />
                                                <input type="hidden" name="cuenta" value="ANTICIPOS" />
                                                <div class="form-group" style="width:60%; min-width:320px">
                                                    <label for="recipient-name" class="col-form-label">Nombre:</label>
                                                    <b>@item.A.N.Nombre</b><br />
                                                    <label for="recipient-name" class="col-form-label">CURP:</label>
                                                    <b>@item.A.N.CURP</b><br />
                                                    <label for="recipient-name" class="col-form-label">NoExpediente:</label>
                                                    <b>@item.A.M.NoExpediente</b><br />
                                                    <label for="recipient-name" class="col-form-label">Fecha:</label>
                                                    <b>@Convert.ToDateTime(item.A.M.FechaReferencia).ToString("dd-MMMM-yyyy")</b><br />
                                                    <label for="recipient-name" class="col-form-label">Sucursal:</label>
                                                    <b>@item.A.M.Sucursal</b><br />
                                                    <label for="recipient-name" class="col-form-label">Doctor:</label>
                                                    <b>@item.A.M.Doctor</b><br />
                                                    <label for="recipient-name" class="col-form-label">Tipo de Pago:</label>
                                                    <select required name="pago" style="width:100%; min-height:5vh; min-width:99%; font-size:2vh" class="form-select">
                                                        <option selected disabled>Seleccionar</option>
                                                        <option value="Referencía BanBajío">Referencía BanBajío</option>
                                                        <option value="Transferencia vía BanBajío">Transferencia vía BanBajío</option>
                                                        <option value="Banorte">Banorte</option>
                                                        <option value="Santander">Santander</option>
                                                        <option value="BanCoppel TLS">BanCoppel TLS</option>
                                                        <option value="BanCoppel LC">BanCoppel LC</option>
                                                        <option value="Banco Azteca TLS">Banco Azteca TLS</option>
                                                        <option value="Banco Azteca LC">Banco Azteca LC</option>
                                                        <option value="Cuenta Externa">Cuenta Externa</option>
                                                        <option value="Credito Empresas">Credito Empresas</option>
                                                    </select>
                                                    <br />
                                                    <label for="recipient-name" class="col-form-label">¿Desea agregar un comentario?:</label>
                                                    <input type="text" class="form-control" name="comentario" />
                                                    <input type="hidden" name="usuario" value="@oUser.Nombre" />
                                                    <input type="hidden" name="fechaInicio" value="@fechaInicio" />
                                                    @{

                                                        if (ViewBag.fechafinal != null)
                                                        {

                                                            <input type="hidden" name="fechaFinal" value="@SetFechaFinal" />

                                                        }

                                                        else
                                                        {

                                                            <input type="hidden" name="fechaFinal" value="@DateTime.Today" />


                                                        }

                                                    }
                                                    <input type="hidden" name="cuenta2" value="@cuenta" />
                                                    <input type="hidden" name="canal" value="@canal" />
                                                    <input type="hidden" name="sucursal" value="@sucursal" />
                                                </div>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                                                <input type="submit" value="Guardar" class="btn btn-primary" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>

                            <!-- Cuentas X Cobrar -->
                            <form method="post" enctype="multipart/form-data" action="@Url.Content("~/Contabilidad/CambiarCuenta")">
                                @Html.AntiForgeryToken()
                                <div class="modal fade" id="CXC_@item.A.M.idCita" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h4 class="modal-title" id="exampleModalLabel"><b>¿Está seguro de mandar los datos de esta venta a CUENTAS X COBRAR?</b></h4>
                                            </div>
                                            <div class="modal-body">
                                                <input type="hidden" name="id" value="@item.A.M.idCita" />
                                                <input type="hidden" name="cuenta" value="CUENTAS X COBRAR" />
                                                <div class="form-group" style="width:60%; min-width:320px">
                                                    <label for="recipient-name" class="col-form-label">Nombre:</label>
                                                    <b>@item.A.N.Nombre</b><br />
                                                    <label for="recipient-name" class="col-form-label">CURP:</label>
                                                    <b>@item.A.N.CURP</b><br />
                                                    <label for="recipient-name" class="col-form-label">NoExpediente:</label>
                                                    <b>@item.A.M.NoExpediente</b><br />
                                                    <label for="recipient-name" class="col-form-label">Fecha:</label>
                                                    <b>@Convert.ToDateTime(item.A.M.FechaReferencia).ToString("dd-MMMM-yyyy")</b><br />
                                                    <label for="recipient-name" class="col-form-label">Sucursal:</label>
                                                    <b>@item.A.M.Sucursal</b><br />
                                                    <label for="recipient-name" class="col-form-label">Doctor:</label>
                                                    <b>@item.A.M.Doctor</b><br />
                                                    <label for="recipient-name" class="col-form-label">Tipo de Pago:</label>
                                                    <select required name="pago" style="width:100%; min-height:5vh; min-width:99%; font-size:2vh" class="form-select">
                                                        <option selected disabled>Seleccionar</option>
                                                        <option value="Pendiente de Pago">Pendiente de Pago</option>
                                                    </select>
                                                    <br />
                                                    <label for="recipient-name" class="col-form-label">¿Desea agregar un comentario?:</label>
                                                    <input type="text" class="form-control" name="comentario" />
                                                    <input type="hidden" name="usuario" value="@oUser.Nombre" />
                                                    <input type="hidden" name="fechaInicio" value="@fechaInicio" />
                                                    @{

                                                        if (ViewBag.fechafinal != null)
                                                        {

                                                            <input type="hidden" name="fechaFinal" value="@SetFechaFinal" />

                                                        }

                                                        else
                                                        {

                                                            <input type="hidden" name="fechaFinal" value="@DateTime.Today" />


                                                        }

                                                    }
                                                    <input type="hidden" name="cuenta2" value="@cuenta" />
                                                    <input type="hidden" name="canal" value="@canal" />
                                                    <input type="hidden" name="sucursal" value="@sucursal" />
                                                </div>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                                                <input type="submit" value="Guardar" class="btn btn-primary" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>

                            <!-- Aclaraciones -->
                            <form method="post" enctype="multipart/form-data" action="@Url.Content("~/Contabilidad/CambiarCuenta")">
                                @Html.AntiForgeryToken()
                                <div class="modal fade" id="Aclaracion_@item.A.M.idCita" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h4 class="modal-title" id="exampleModalLabel"><b>¿Está seguro de mandar los datos de esta venta a ACLARACIONES?</b></h4>
                                            </div>
                                            <div class="modal-body">
                                                <input type="hidden" name="id" value="@item.A.M.idCita" />
                                                <input type="hidden" name="cuenta" value="ACLARACIONES" />
                                                <div class="form-group" style="width:60%; min-width:320px">
                                                    <label for="recipient-name" class="col-form-label">Nombre:</label>
                                                    <b>@item.A.N.Nombre</b><br />
                                                    <label for="recipient-name" class="col-form-label">CURP:</label>
                                                    <b>@item.A.N.CURP</b><br />
                                                    <label for="recipient-name" class="col-form-label">NoExpediente:</label>
                                                    <b>@item.A.M.NoExpediente</b><br />
                                                    <label for="recipient-name" class="col-form-label">Fecha:</label>
                                                    <b>@Convert.ToDateTime(item.A.M.FechaReferencia).ToString("dd-MMMM-yyyy")</b><br />
                                                    <label for="recipient-name" class="col-form-label">Sucursal:</label>
                                                    <b>@item.A.M.Sucursal</b><br />
                                                    <label for="recipient-name" class="col-form-label">Doctor:</label>
                                                    <b>@item.A.M.Doctor</b><br />
                                                    <label for="recipient-name" class="col-form-label">Tipo de Pago:</label>
                                                    <select required name="pago" style="width:100%; min-height:5vh; min-width:99%; font-size:2vh" class="form-select">
                                                        <option value="@item.A.M.TipoPago">Seleccionar</option>
                                                        <option value="Referencia OXXO">Referencia OXXO</option>
                                                        <option value="Referencía BanBajío">Referencía BanBajío</option>
                                                        <option value="Transferencia vía BanBajío">Transferencia vía BanBajío</option>
                                                        <option value="Banorte">Banorte</option>
                                                        <option value="Santander">Santander</option>
                                                        <option value="BanCoppel TLS">BanCoppel TLS</option>
                                                        <option value="BanCoppel LC">BanCoppel LC</option>
                                                        <option value="Banco Azteca TLS">Banco Azteca TLS</option>
                                                        <option value="Banco Azteca LC">Banco Azteca LC</option>
                                                        <option value="Cuenta Externa">Cuenta Externa</option>
                                                        <option value="Credito Empresas">Credito Empresas</option>
                                                        <option value="Pendiente de Pago">Pendiente de Pago</option>
                                                    </select>
                                                    <br />
                                                    <label for="recipient-name" class="col-form-label">¿Desea agregar un comentario?:</label>
                                                    <input type="text" class="form-control" name="comentario" />
                                                    <input type="hidden" name="usuario" value="@oUser.Nombre" />
                                                    <input type="hidden" name="fechaInicio" value="@fechaInicio" />
                                                    @{

                                                        if (ViewBag.fechafinal != null)
                                                        {

                                                            <input type="hidden" name="fechaFinal" value="@SetFechaFinal" />

                                                        }

                                                        else
                                                        {

                                                            <input type="hidden" name="fechaFinal" value="@DateTime.Today" />


                                                        }

                                                    }
                                                    <input type="hidden" name="cuenta2" value="@cuenta" />
                                                    <input type="hidden" name="canal" value="@canal" />
                                                    <input type="hidden" name="sucursal" value="@sucursal" />
                                                </div>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                                                <input type="submit" value="Guardar" class="btn btn-primary" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>

                            <!-- Aclaraciones Resueltas -->
                            <form method="post" enctype="multipart/form-data" action="@Url.Content("~/Contabilidad/CambiarCuenta")">
                                @Html.AntiForgeryToken()
                                <div class="modal fade" id="Aclaraciones_Resueltas_@item.A.M.idCita" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h4 class="modal-title" id="exampleModalLabel"><b>¿Está seguro de mandar los datos de esta venta a ACLARACIONES RESUELTAS?</b></h4>
                                            </div>
                                            <div class="modal-body">
                                                <input type="hidden" name="id" value="@item.A.M.idCita" />
                                                <input type="hidden" name="cuenta" value="ACLARACIONES_RESUELTAS" />
                                                <div class="form-group" style="width:60%; min-width:320px">
                                                    <label for="recipient-name" class="col-form-label">Nombre:</label>
                                                    <b>@item.A.N.Nombre</b><br />
                                                    <label for="recipient-name" class="col-form-label">CURP:</label>
                                                    <b>@item.A.N.CURP</b><br />
                                                    <label for="recipient-name" class="col-form-label">NoExpediente:</label>
                                                    <b>@item.A.M.NoExpediente</b><br />
                                                    <label for="recipient-name" class="col-form-label">Fecha:</label>
                                                    <b>@Convert.ToDateTime(item.A.M.FechaReferencia).ToString("dd-MMMM-yyyy")</b><br />
                                                    <label for="recipient-name" class="col-form-label">Sucursal:</label>
                                                    <b>@item.A.M.Sucursal</b><br />
                                                    <label for="recipient-name" class="col-form-label">Doctor:</label>
                                                    <b>@item.A.M.Doctor</b><br />
                                                    <label for="recipient-name" class="col-form-label">Tipo de Pago:</label>
                                                    <select required name="pago" style="width:100%; min-height:5vh; min-width:99%; font-size:2vh" class="form-select">
                                                        <option selected disabled>Seleccionar</option>
                                                        <option value="Referencia OXXO">Referencia OXXO</option>
                                                        <option value="Referencía BanBajío">Referencía BanBajío</option>
                                                        <option value="Transferencia vía BanBajío">Transferencia vía BanBajío</option>
                                                        <option value="Banorte">Banorte</option>
                                                        <option value="Santander">Santander</option>
                                                        <option value="BanCoppel TLS">BanCoppel TLS</option>
                                                        <option value="BanCoppel LC">BanCoppel LC</option>
                                                        <option value="Banco Azteca TLS">Banco Azteca TLS</option>
                                                        <option value="Banco Azteca LC">Banco Azteca LC</option>
                                                        <option value="Cuenta Externa">Cuenta Externa</option>
                                                        <option value="Credito Empresas">Credito Empresas</option>
                                                        <option value="Pendiente de Pago">Pendiente de Pago</option>
                                                    </select>
                                                    <br />
                                                    <label for="recipient-name" class="col-form-label">¿Desea agregar un comentario?:</label>
                                                    <input type="text" class="form-control" name="comentario" />
                                                    <input type="hidden" name="usuario" value="@oUser.Nombre" />
                                                    <input type="hidden" name="fechaInicio" value="@fechaInicio" />
                                                    @{

                                                        if (ViewBag.fechafinal != null)
                                                        {

                                                            <input type="hidden" name="fechaFinal" value="@SetFechaFinal" />

                                                        }

                                                        else
                                                        {

                                                            <input type="hidden" name="fechaFinal" value="@DateTime.Today" />


                                                        }

                                                    }
                                                    <input type="hidden" name="cuenta2" value="@cuenta" />
                                                    <input type="hidden" name="canal" value="@canal" />
                                                    <input type="hidden" name="sucursal" value="@sucursal" />
                                                </div>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                                                <input type="submit" value="Guardar" class="btn btn-primary" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>

                            <!-- Devoluciones -->
                            <form method="post" enctype="multipart/form-data" action="@Url.Content("~/Contabilidad/CambiarCuenta")">
                                @Html.AntiForgeryToken()
                                <div class="modal fade" id="Devoluciones_@item.A.M.idCita" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h4 class="modal-title" id="exampleModalLabel"><b>¿Está seguro de mandar los datos de esta venta DEVOLUCIONES?</b></h4>
                                            </div>
                                            <div class="modal-body">
                                                <input type="hidden" name="id" value="@item.A.M.idCita" />
                                                <input type="hidden" name="cuenta" value="DEVOLUCIONES" />
                                                <div class="form-group" style="width:60%; min-width:320px">
                                                    <label for="recipient-name" class="col-form-label">Nombre:</label>
                                                    <b>@item.A.N.Nombre</b><br />
                                                    <label for="recipient-name" class="col-form-label">CURP:</label>
                                                    <b>@item.A.N.CURP</b><br />
                                                    <label for="recipient-name" class="col-form-label">NoExpediente:</label>
                                                    <b>@item.A.M.NoExpediente</b><br />
                                                    <label for="recipient-name" class="col-form-label">Fecha:</label>
                                                    <b>@Convert.ToDateTime(item.A.M.FechaReferencia).ToString("dd-MMMM-yyyy")</b><br />
                                                    <label for="recipient-name" class="col-form-label">Sucursal:</label>
                                                    <b>@item.A.M.Sucursal</b><br />
                                                    <label for="recipient-name" class="col-form-label">Doctor:</label>
                                                    <b>@item.A.M.Doctor</b><br />
                                                    <label for="recipient-name" class="col-form-label">Tipo de Pago:</label>
                                                    <select required name="pago" style="width:100%; min-height:5vh; min-width:99%; font-size:2vh" class="form-select">
                                                        <option selected disabled>Seleccionar</option>
                                                        <option value="Referencia OXXO">Referencia OXXO</option>
                                                        <option value="Referencía BanBajío">Referencía BanBajío</option>
                                                        <option value="Transferencia vía BanBajío">Transferencia vía BanBajío</option>
                                                        <option value="Banorte">Banorte</option>
                                                        <option value="Santander">Santander</option>
                                                        <option value="BanCoppel TLS">BanCoppel TLS</option>
                                                        <option value="BanCoppel LC">BanCoppel LC</option>
                                                        <option value="Banco Azteca TLS">Banco Azteca TLS</option>
                                                        <option value="Banco Azteca LC">Banco Azteca LC</option>
                                                        <option value="Cuenta Externa">Cuenta Externa</option>
                                                        <option value="Credito Empresas">Credito Empresas</option>
                                                        <option value="Pendiente de Pago">Pendiente de Pago</option>
                                                    </select>
                                                    <br />
                                                    <label for="recipient-name" class="col-form-label">Fecha de pago contable:</label>
                                                    <input type="date" class="form-control" name="fechaContable" />
                                                    <label for="recipient-name" class="col-form-label">¿Desea agregar un comentario?:</label>
                                                    <input type="text" class="form-control" name="comentario" />
                                                    <input type="hidden" name="usuario" value="@oUser.Nombre" />
                                                    <input type="hidden" name="fechaInicio" value="@fechaInicio" />
                                                    @{

                                                        if (ViewBag.fechafinal != null)
                                                        {

                                                            <input type="hidden" name="fechaFinal" value="@SetFechaFinal" />

                                                        }

                                                        else
                                                        {

                                                            <input type="hidden" name="fechaFinal" value="@DateTime.Today" />


                                                        }

                                                    }
                                                    <input type="hidden" name="cuenta2" value="@cuenta" />
                                                    <input type="hidden" name="canal" value="@canal" />
                                                    <input type="hidden" name="sucursal" value="@sucursal" />
                                                </div>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                                                <input type="submit" value="Guardar" class="btn btn-primary" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>

                    </td>
                </tr>
                flag++;
            }
        }


        @*AQUI EMPIEZAN LOS ALTERNATIVOS*@

        @{
            foreach (var item in modelo1)
            {
                if (item.CanalTipo == "IN SITU")
                {
                    fila = "#AFEEEE";
                }
                else if (item.CanalTipo == "GESTOR ALT")
                {
                    fila = "#c3c3c3";
                }
                else
                {
                    fila = "white";
                }
                <tr style="background-color:@fila">
                    <td>
                        @flag
                    </td>
                    <td style="font-size:smaller">
                        @{
                            string[] historico = item.CuentaComentario != null ? item.CuentaComentario.Split('+') : null;
                            int flag0 = 1;

                            if (item.CuentaComentario == null)
                            {
                                <b>@item.Nombre</b>
                            }
                            else
                            {
                                <span class="field-tip">
                                    <b>@item.Nombre</b>
                                    <span class="tip-content">
                                        @{
                                            foreach (var i in historico)
                                            {
                                                <span>@flag0 @i</span><br />
                                                flag0++;
                                            }
                                        }
                                    </span>
                                </span>
                            }
                        }
                    </td>

                    <td>
                        -----
                    </td>
                    <td>
                        -----
                    </td>
                    <td style="font-size:smaller">
                        <span class="field-tip">
                            <b>@item.ReferidoPor</b>
                            <span class="tip-content">
                                CANAL: @item.CanalTipo
                            </span>
                        </span>
                    </td>
                    <td style="font-size:smaller">
                        @{
                            if (item.Cuenta == null)
                            {
                                <span>Caja</span>
                            }
                            else
                            {
                                <span>@item.Cuenta</span>
                            }
                        }
                    </td>
                    <td>
                        @item.TipoPago
                    </td>
                    <td>
                        @Convert.ToDateTime(item.FechaCaptura).ToString("dd-MM-yy")
                    </td>

                    @*FECHA CONTABLE*@
                    <td>
                        <span class="field-tip">
                            @{
                                if (item.Cuenta == "BANCOS" || item.Cuenta == "CONEKTA")
                                {
                                    @Convert.ToDateTime(item.FechaContable).ToString("dd-MM-yy")
                                }

                                else
                                {
                                    <span><mark style="background-color: #FFFF00; padding:5px; border-radius:7px">---------</mark></span>

                                }
                            }
                            <span class="tip-content">

                                @{
                                    if (item.FechaContable != null)
                                    {
                                        <b>Ultimo Movimiento Contable:</b>
                                        <b>@Convert.ToDateTime(item.FechaContable).ToString("dd-MMMM-yy")</b>
                                    }

                                    else
                                    {
                                        <b>No hay Movimientos Contables</b>
                                    }
                                }

                            </span>
                        </span>
                    </td>
                    <td>
                        @{

                            //OPCION CON PRECIO EN TABLA CAPTURA
                            var costo = (from i in db.PacienteESP where i.idPacienteESP == item.idPacienteESP select i).FirstOrDefault();

                            <span><b>$@costo.PrecioEpi</b></span>                       
                        }

                    </td>
                    <td style="font-size:smaller">
                        @item.Solicita
                    </td>
                    <td>
                        <div class="btn-group">
                            @{
                                if (oUser.Nombre != "Maribel Hernandez")
                                {
                                    if (oUser.idRol == 2 || oUser.Nombre == "José Luis Mora")
                                    {
                                        <button type="button" class="btn btn-info dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            Acciones <span class="glyphicon glyphicon-triangle-bottom"></span>
                                        </button>

                                        <div class="dropdown-menu" style="padding:10px">
                                            <a href="#" data-toggle="modal" data-target="#Efectivo1_@item.idPacienteESP"><b>Bancos</b></a>
                                            <div class="dropdown-divider"></div>
                                            <a href="#" data-toggle="modal" data-target="#Conekta1_@item.idPacienteESP"><b>Conekta</b></a>
                                            <div class="dropdown-divider"></div>
                                            <a href="#" data-toggle="modal" data-target="#Anticipos1_@item.idPacienteESP"><b>Anticipos</b></a>
                                            <div class="dropdown-divider"></div>
                                            <a href="#" data-toggle="modal" data-target="#CXC1_@item.idPacienteESP"><b>CuentasXCobrar</b></a>
                                            <div class="dropdown-divider"></div>
                                            @*<a href="#" data-toggle="modal" data-target="#Corporativo_@item.A.M.idCita"><b>Corporativo</b></a>
                        <div class="dropdown-divider"></div>*@
                                            @{
                                                if (item.Cuenta != "ACLARACIONES")
                                                {
                                                    <a href="#" data-toggle="modal" data-target="#Aclaracion1_@item.idPacienteESP"><b>Aclaracion</b></a>
                                                    <div class="dropdown-divider"></div>
                                                }
                                            }

                                            @{
                                                if (oUser.idRol == 2 || oUser.Nombre == "Flavio Rodrigo")
                                                {
                                                    if (item.Cuenta == "ACLARACIONES")
                                                    {
                                                        <a href="#" data-toggle="modal" data-target="#Aclaracion1_Resuelta_@item.idPacienteESP"><b>Aclaraciones Resueltas</b></a>
                                                        <div class="dropdown-divider"></div>
                                                    }
                                                }
                                            }
                                            <a href="#" data-toggle="modal" data-target="#Devoluciones1_@item.idPacienteESP"><b>Devoluciones</b></a>
                                            <div class="dropdown-divider"></div>
                                            @*<a href="#" data-toggle="modal" data-target="#CONCILIADO_@item.A.M.idPaciente"><b>CONCILIADO</b></a>
                        <div class="dropdown-divider"></div>*@

                                        </div>
                                    }
                                    else if (item.Conciliado != null && (item.Cuenta == "BANCOS" || item.Cuenta == "CONEKTA"))
                                    {
                                        <b style="font-size:x-small">CONCILIADO </b><span class="glyphicon glyphicon-ok" style="font-size:x-small"></span>
                                    }
                                    else
                                    {
                                        <button type="button" class="btn btn-info dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            Acciones <span class="glyphicon glyphicon-triangle-bottom"></span>
                                        </button>

                                        <div class="dropdown-menu" style="padding:10px">
                                            <a href="#" data-toggle="modal" data-target="#Efectivo1_@item.idPacienteESP"><b>Bancos</b></a>
                                            <div class="dropdown-divider"></div>
                                            <a href="#" data-toggle="modal" data-target="#Conekta1_@item.idPacienteESP"><b>Conekta</b></a>
                                            <div class="dropdown-divider"></div>
                                            <a href="#" data-toggle="modal" data-target="#Anticipos1_@item.idPacienteESP"><b>Anticipos</b></a>
                                            <div class="dropdown-divider"></div>
                                            <a href="#" data-toggle="modal" data-target="#CXC1_@item.idPacienteESP"><b>CuentasXCobrar</b></a>
                                            <div class="dropdown-divider"></div>
                                            @*<a href="#" data-toggle="modal" data-target="#Corporativo_@item.A.M.idCita"><b>Corporativo</b></a>
                        <div class="dropdown-divider"></div>*@
                                            <a href="#" data-toggle="modal" data-target="#Aclaracion1_@item.idPacienteESP"><b>Aclaracion</b></a>
                                            <div class="dropdown-divider"></div>
                                            <a href="#" data-toggle="modal" data-target="#Devoluciones1_@item.idPacienteESP"><b>Devoluciones</b></a>
                                            <div class="dropdown-divider"></div>
                                            @*<a href="#" data-toggle="modal" data-target="#CONCILIADO_@item.A.M.idPaciente"><b>CONCILIADO</b></a>
                        <div class="dropdown-divider"></div>*@

                                        </div>
                                    }
                                }
                            }


                            <!-- Efectivo -->
                            <form method="post" enctype="multipart/form-data" action="@Url.Content("~/Contabilidad/CambiarCuentaALT")">
                                @Html.AntiForgeryToken()
                                <div class="modal fade" id="Efectivo1_@item.idPacienteESP" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h4 class="modal-title" id="exampleModalLabel"><b>¿Está seguro de mandar los datos de esta venta a BANCOS?</b></h4>
                                            </div>
                                            <div class="modal-body">
                                                <input type="hidden" name="id" value="@item.idPacienteESP" />
                                                <input type="hidden" name="cuenta" value="BANCOS" />
                                                <div class="form-group" style="width:60%; min-width:320px">
                                                    <label for="recipient-name" class="col-form-label">Nombre:</label>
                                                    <b>@item.Nombre</b><br />
                                                    <label for="recipient-name" class="col-form-label">CURP:</label>
                                                    <b>@item.CURP</b><br />
                                                    <label for="recipient-name" class="col-form-label">NoExpediente:</label>
                                                    <b>@item.NoExpediente</b><br />
                                                    <label for="recipient-name" class="col-form-label">Fecha:</label>
                                                    <b>@Convert.ToDateTime(item.FechaCaptura).ToString("dd-MMMM-yyyy")</b><br />
                                                    <label for="recipient-name" class="col-form-label">Doctor:</label>
                                                    <b>@item.Doctor</b><br />
                                                    <label for="recipient-name" class="col-form-label">Tipo de Pago:</label>
                                                    <select required name="pago" style="width:100%; min-height:5vh; min-width:99%; font-size:2vh" class="form-select">
                                                        <option selected disabled>Seleccionar</option>
                                                        <option value="Referencía BanBajío">Referencía BanBajío</option>
                                                        <option value="Transferencia vía BanBajío">Transferencia vía BanBajío</option>
                                                        <option value="Banorte">Banorte</option>
                                                        <option value="Santander">Santander</option>
                                                        <option value="BanCoppel TLS">BanCoppel TLS</option>
                                                        <option value="BanCoppel LC">BanCoppel LC</option>
                                                        <option value="Banco Azteca TLS">Banco Azteca TLS</option>
                                                        <option value="Banco Azteca LC">Banco Azteca LC</option>
                                                        <option value="Cuenta Externa">Cuenta Externa</option>
                                                        <option value="Credito Empresas">Credito Empresas</option>
                                                    </select>
                                                    <br />

                                                    @*CAMPO REQUERIDO PARA SELECTORES*@
                                                    <br />
                                                    <div class="form-group" style="width:60%; min-width:320px">
                                                        <label for="recipient-name" class="form-select" required>Indique Forma de Pago</label>
                                                        <select name="FormadePago" style="width:100%; min-height:5vh; min-width:99%; font-size:2vh" class="form-control" required>
                                                            <option disabled selected value="">Seleccione una opcion</option>
                                                            <option value="EFECTIVO">Efectivo</option>
                                                            <option value="TRANSFERENCIA">Transferencia</option>
                                                            <option value="TARJETA">Tarjeta</option>
                                                        </select>
                                                    </div>

                                                    <label for="recipient-name" class="col-form-label">Fecha de pago contable:</label>
                                                    <input type="date" class="form-control" name="fechaContable" />
                                                    <label for="recipient-name" class="col-form-label">¿Desea agregar un comentario?:</label>
                                                    <input type="text" class="form-control" name="comentario" />
                                                    <input type="hidden" name="usuario" value="@oUser.Nombre" />
                                                    <input type="hidden" name="fechaInicio" value="@fechaInicio" />
                                                    <input type="hidden" name="fechaFinal" value="@fechaFinal" />
                                                    <input type="hidden" name="cuenta2" value="@cuenta" />
                                                    <input type="hidden" name="canal" value="@canal" />
                                                    <input type="hidden" name="sucursal" value="@sucursal" />
                                                </div>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                                                <input type="submit" value="Guardar" class="btn btn-primary" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>

                            <!-- Conekta -->
                            <form method="post" enctype="multipart/form-data" action="@Url.Content("~/Contabilidad/CambiarCuentaALT")">
                                @Html.AntiForgeryToken()
                                <div class="modal fade" id="Conekta1_@item.idPacienteESP" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h4 class="modal-title" id="exampleModalLabel"><b>¿Está seguro de mandar los datos de esta venta a Conekta?</b></h4>
                                            </div>
                                            <div class="modal-body">
                                                <input type="hidden" name="id" value="@item.idPacienteESP" />
                                                <input type="hidden" name="cuenta" value="CONEKTA" />
                                                <div class="form-group" style="width:60%; min-width:320px">
                                                    <label for="recipient-name" class="col-form-label">Nombre:</label>
                                                    <b>@item.Nombre</b><br />
                                                    <label for="recipient-name" class="col-form-label">CURP:</label>
                                                    <b>@item.CURP</b><br />
                                                    <label for="recipient-name" class="col-form-label">NoExpediente:</label>
                                                    <b>@item.NoExpediente</b><br />
                                                    <label for="recipient-name" class="col-form-label">Fecha:</label>
                                                    <b>@Convert.ToDateTime(item.FechaCaptura).ToString("dd-MMMM-yyyy")</b><br />
                                                    <label for="recipient-name" class="col-form-label">Doctor:</label>
                                                    <b>@item.Doctor</b><br />
                                                    <label for="recipient-name" class="col-form-label">Tipo de Pago:</label>
                                                    <select required name="pago" style="width:100%; min-height:5vh; min-width:99%; font-size:2vh" class="form-select">
                                                        <option selected disabled>Seleccionar</option>
                                                        <option value="Referencia OXXO">Referencia OXXO</option>

                                                    </select>
                                                    <br />


                                                    @*CAMPO REQUERIDO PARA SELECTORES*@
                                                    <br />
                                                    <div class="form-group" style="width:60%; min-width:320px">
                                                        <label for="recipient-name" class="form-select" required>Indique Forma de Pago</label>
                                                        <select name="FormadePago" style="width:100%; min-height:5vh; min-width:99%; font-size:2vh" class="form-control" required>
                                                            <option disabled selected value="">Seleccione una opcion</option>
                                                            <option value="EFECTIVO">Efectivo</option>
                                                            <option value="TRANSFERENCIA">Transferencia</option>
                                                            <option value="TARJETA">Tarjeta</option>
                                                        </select>
                                                    </div>

                                                    <label for="recipient-name" class="col-form-label">Fecha de pago contable:</label>
                                                    <input type="date" class="form-control" name="fechaContable" />
                                                    <label for="recipient-name" class="col-form-label">¿Desea agregar un comentario?:</label>
                                                    <input type="text" class="form-control" name="comentario" />
                                                    <input type="hidden" name="usuario" value="@oUser.Nombre" />
                                                    <input type="hidden" name="fechaInicio" value="@fechaInicio" />
                                                    <input type="hidden" name="fechaFinal" value="@fechaFinal" />
                                                    <input type="hidden" name="cuenta2" value="@cuenta" />
                                                    <input type="hidden" name="canal" value="@canal" />
                                                    <input type="hidden" name="sucursal" value="@sucursal" />
                                                </div>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                                                <input type="submit" value="Guardar" class="btn btn-primary" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>

                            <!-- Anticipos -->
                            <form method="post" enctype="multipart/form-data" action="@Url.Content("~/Contabilidad/CambiarCuentaALT")">
                                @Html.AntiForgeryToken()
                                <div class="modal fade" id="Anticipos1_@item.idPacienteESP" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h4 class="modal-title" id="exampleModalLabel"><b>¿Está seguro de mandar los datos de esta venta a ANTICIPOS?</b></h4>
                                            </div>
                                            <div class="modal-body">
                                                <input type="hidden" name="id" value="@item.idPacienteESP" />
                                                <input type="hidden" name="cuenta" value="ANTICIPOS" />
                                                <div class="form-group" style="width:60%; min-width:320px">
                                                    <label for="recipient-name" class="col-form-label">Nombre:</label>
                                                    <b>@item.Nombre</b><br />
                                                    <label for="recipient-name" class="col-form-label">CURP:</label>
                                                    <b>@item.CURP</b><br />
                                                    <label for="recipient-name" class="col-form-label">NoExpediente:</label>
                                                    <b>@item.NoExpediente</b><br />
                                                    <label for="recipient-name" class="col-form-label">Fecha:</label>
                                                    <b>@Convert.ToDateTime(item.FechaCaptura).ToString("dd-MMMM-yyyy")</b><br />
                                                    <label for="recipient-name" class="col-form-label">Doctor:</label>
                                                    <b>@item.Doctor</b><br />
                                                    <label for="recipient-name" class="col-form-label">Tipo de Pago:</label>
                                                    <select required name="pago" style="width:100%; min-height:5vh; min-width:99%; font-size:2vh" class="form-select">
                                                        <option selected disabled>Seleccionar</option>
                                                        <option value="Referencia OXXO">Referencia OXXO</option>
                                                        <option value="Referencía BanBajío">Referencía BanBajío</option>
                                                        <option value="Transferencia vía BanBajío">Transferencia vía BanBajío</option>
                                                        <option value="Banorte">Banorte</option>
                                                        <option value="Santander">Santander</option>
                                                        <option value="BanCoppel TLS">BanCoppel TLS</option>
                                                        <option value="BanCoppel LC">BanCoppel LC</option>
                                                        <option value="Banco Azteca TLS">Banco Azteca TLS</option>
                                                        <option value="Banco Azteca LC">Banco Azteca LC</option>
                                                        <option value="Cuenta Externa">Cuenta Externa</option>
                                                        <option value="Credito Empresas">Credito Empresas</option>
                                                        <option value="Pendiente de Pago">Pendiente de Pago</option>
                                                    </select>
                                                    <br />
                                                    <label for="recipient-name" class="col-form-label">Fecha de pago contable:</label>
                                                    <input type="date" class="form-control" name="fechaContable" />
                                                    <label for="recipient-name" class="col-form-label">¿Desea agregar un comentario?:</label>
                                                    <input type="text" class="form-control" name="comentario" />
                                                    <input type="hidden" name="usuario" value="@oUser.Nombre" />
                                                    <input type="hidden" name="fechaInicio" value="@fechaInicio" />
                                                    <input type="hidden" name="fechaFinal" value="@fechaFinal" />
                                                    <input type="hidden" name="cuenta2" value="@cuenta" />
                                                    <input type="hidden" name="canal" value="@canal" />
                                                    <input type="hidden" name="sucursal" value="@sucursal" />
                                                </div>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                                                <input type="submit" value="Guardar" class="btn btn-primary" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>

                            <!-- CXC -->
                            <form method="post" enctype="multipart/form-data" action="@Url.Content("~/Contabilidad/CambiarCuentaALT")">
                                @Html.AntiForgeryToken()
                                <div class="modal fade" id="CXC1_@item.idPacienteESP" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h4 class="modal-title" id="exampleModalLabel"><b>¿Está seguro de mandar los datos de esta venta a CUENTAS X COBRAR?</b></h4>
                                            </div>
                                            <div class="modal-body">
                                                <input type="hidden" name="id" value="@item.idPacienteESP" />
                                                <input type="hidden" name="cuenta" value="CUENTAS X COBRAR" />
                                                <div class="form-group" style="width:60%; min-width:320px">
                                                    <label for="recipient-name" class="col-form-label">Nombre:</label>
                                                    <b>@item.Nombre</b><br />
                                                    <label for="recipient-name" class="col-form-label">CURP:</label>
                                                    <b>@item.CURP</b><br />
                                                    <label for="recipient-name" class="col-form-label">NoExpediente:</label>
                                                    <b>@item.NoExpediente</b><br />
                                                    <label for="recipient-name" class="col-form-label">Fecha:</label>
                                                    <b>@Convert.ToDateTime(item.FechaCaptura).ToString("dd-MMMM-yyyy")</b><br />
                                                    <label for="recipient-name" class="col-form-label">Doctor:</label>
                                                    <b>@item.Doctor</b><br />
                                                    <label for="recipient-name" class="col-form-label">Tipo de Pago:</label>
                                                    <select required name="pago" style="width:100%; min-height:5vh; min-width:99%; font-size:2vh" class="form-select">
                                                        <option selected disabled>Seleccionar</option>
                                                        <option value="Pendiente de Pago">Pendiente de Pago</option>
                                                    </select>
                                                    <br />
                                                    <label for="recipient-name" class="col-form-label">¿Desea agregar un comentario?:</label>
                                                    <input type="text" class="form-control" name="comentario" />
                                                    <input type="hidden" name="usuario" value="@oUser.Nombre" />
                                                    <input type="hidden" name="fechaInicio" value="@fechaInicio" />
                                                    <input type="hidden" name="fechaFinal" value="@fechaFinal" />
                                                    <input type="hidden" name="cuenta2" value="@cuenta" />
                                                    <input type="hidden" name="canal" value="@canal" />
                                                    <input type="hidden" name="sucursal" value="@sucursal" />
                                                </div>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                                                <input type="submit" value="Guardar" class="btn btn-primary" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>

                            <!-- ACLARACIONES -->
                            <form method="post" enctype="multipart/form-data" action="@Url.Content("~/Contabilidad/CambiarCuentaALT")">
                                @Html.AntiForgeryToken()
                                <div class="modal fade" id="Aclaracion1_@item.idPacienteESP" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h4 class="modal-title" id="exampleModalLabel"><b>¿Está seguro de mandar los datos de esta venta a ACLARACIONES?</b></h4>
                                            </div>
                                            <div class="modal-body">
                                                <input type="hidden" name="id" value="@item.idPacienteESP" />
                                                <input type="hidden" name="cuenta" value="ACLARACIONES" />
                                                <div class="form-group" style="width:60%; min-width:320px">
                                                    <label for="recipient-name" class="col-form-label">Nombre:</label>
                                                    <b>@item.Nombre</b><br />
                                                    <label for="recipient-name" class="col-form-label">CURP:</label>
                                                    <b>@item.CURP</b><br />
                                                    <label for="recipient-name" class="col-form-label">NoExpediente:</label>
                                                    <b>@item.NoExpediente</b><br />
                                                    <label for="recipient-name" class="col-form-label">Fecha:</label>
                                                    <b>@Convert.ToDateTime(item.FechaCaptura).ToString("dd-MMMM-yyyy")</b><br />
                                                    <label for="recipient-name" class="col-form-label">Doctor:</label>
                                                    <b>@item.Doctor</b><br />
                                                    <label for="recipient-name" class="col-form-label">Tipo de Pago:</label>
                                                    <select required name="pago" style="width:100%; min-height:5vh; min-width:99%; font-size:2vh" class="form-select">
                                                        <option selected disabled>Seleccionar</option>
                                                        <option value="Referencia OXXO">Referencia OXXO</option>
                                                        <option value="Referencía BanBajío">Referencía BanBajío</option>
                                                        <option value="Transferencia vía BanBajío">Transferencia vía BanBajío</option>
                                                        <option value="Banorte">Banorte</option>
                                                        <option value="Santander">Santander</option>
                                                        <option value="BanCoppel TLS">BanCoppel TLS</option>
                                                        <option value="BanCoppel LC">BanCoppel LC</option>
                                                        <option value="Banco Azteca TLS">Banco Azteca TLS</option>
                                                        <option value="Banco Azteca LC">Banco Azteca LC</option>
                                                        <option value="Cuenta Externa">Cuenta Externa</option>
                                                        <option value="Credito Empresas">Credito Empresas</option>
                                                        <option value="Pendiente de Pago">Pendiente de Pago</option>
                                                    </select>
                                                    <br />
                                                    <label for="recipient-name" class="col-form-label">¿Desea agregar un comentario?:</label>
                                                    <input type="text" class="form-control" name="comentario" />
                                                    <input type="hidden" name="usuario" value="@oUser.Nombre" />
                                                    <input type="hidden" name="fechaInicio" value="@fechaInicio" />
                                                    <input type="hidden" name="fechaFinal" value="@fechaFinal" />
                                                    <input type="hidden" name="cuenta2" value="@cuenta" />
                                                    <input type="hidden" name="canal" value="@canal" />
                                                    <input type="hidden" name="sucursal" value="@sucursal" />
                                                </div>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                                                <input type="submit" value="Guardar" class="btn btn-primary" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>

                            <!-- ACLARACIONES RESUELTAS -->
                            <form method="post" enctype="multipart/form-data" action="@Url.Content("~/Contabilidad/CambiarCuentaALT")">
                                @Html.AntiForgeryToken()
                                <div class="modal fade" id="Aclaracion1_Resuelta_@item.idPacienteESP" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h4 class="modal-title" id="exampleModalLabel"><b>¿Está seguro de mandar los datos de esta venta a ACLARACIONES RESUELTAS?</b></h4>
                                            </div>
                                            <div class="modal-body">
                                                <input type="hidden" name="id" value="@item.idPacienteESP" />
                                                <input type="hidden" name="cuenta" value="ACLARACIONES_RESUELTAS" />
                                                <div class="form-group" style="width:60%; min-width:320px">
                                                    <label for="recipient-name" class="col-form-label">Nombre:</label>
                                                    <b>@item.Nombre</b><br />
                                                    <label for="recipient-name" class="col-form-label">CURP:</label>
                                                    <b>@item.CURP</b><br />
                                                    <label for="recipient-name" class="col-form-label">NoExpediente:</label>
                                                    <b>@item.NoExpediente</b><br />
                                                    <label for="recipient-name" class="col-form-label">Fecha:</label>
                                                    <b>@Convert.ToDateTime(item.FechaCaptura).ToString("dd-MMMM-yyyy")</b><br />
                                                    <label for="recipient-name" class="col-form-label">Doctor:</label>
                                                    <b>@item.Doctor</b><br />
                                                    <label for="recipient-name" class="col-form-label">Tipo de Pago:</label>
                                                    <select required name="pago" style="width:100%; min-height:5vh; min-width:99%; font-size:2vh" class="form-select">
                                                        <option selected disabled>Seleccionar</option>
                                                        <option value="Referencia OXXO">Referencia OXXO</option>
                                                        <option value="Referencía BanBajío">Referencía BanBajío</option>
                                                        <option value="Transferencia vía BanBajío">Transferencia vía BanBajío</option>
                                                        <option value="Banorte">Banorte</option>
                                                        <option value="Santander">Santander</option>
                                                        <option value="BanCoppel TLS">BanCoppel TLS</option>
                                                        <option value="BanCoppel LC">BanCoppel LC</option>
                                                        <option value="Banco Azteca TLS">Banco Azteca TLS</option>
                                                        <option value="Banco Azteca LC">Banco Azteca LC</option>
                                                        <option value="Cuenta Externa">Cuenta Externa</option>
                                                        <option value="Credito Empresas">Credito Empresas</option>
                                                        <option value="Pendiente de Pago">Pendiente de Pago</option>
                                                    </select>
                                                    <br />
                                                    <label for="recipient-name" class="col-form-label">¿Desea agregar un comentario?:</label>
                                                    <input type="text" class="form-control" name="comentario" />
                                                    <input type="hidden" name="usuario" value="@oUser.Nombre" />
                                                    <input type="hidden" name="fechaInicio" value="@fechaInicio" />
                                                    <input type="hidden" name="fechaFinal" value="@fechaFinal" />
                                                    <input type="hidden" name="cuenta2" value="@cuenta" />
                                                    <input type="hidden" name="canal" value="@canal" />
                                                    <input type="hidden" name="sucursal" value="@sucursal" />
                                                </div>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                                                <input type="submit" value="Guardar" class="btn btn-primary" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>

                            <!-- DEVOLUCIONES -->
                            <form method="post" enctype="multipart/form-data" action="@Url.Content("~/Contabilidad/CambiarCuentaALT")">
                                @Html.AntiForgeryToken()
                                <div class="modal fade" id="Devoluciones1_@item.idPacienteESP" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h4 class="modal-title" id="exampleModalLabel"><b>¿Está seguro de mandar los datos de esta venta a DEVOLUCIONES?</b></h4>
                                            </div>
                                            <div class="modal-body">
                                                <input type="hidden" name="id" value="@item.idPacienteESP" />
                                                <input type="hidden" name="cuenta" value="DEVOLUCIONES" />
                                                <div class="form-group" style="width:60%; min-width:320px">
                                                    <label for="recipient-name" class="col-form-label">Nombre:</label>
                                                    <b>@item.Nombre</b><br />
                                                    <label for="recipient-name" class="col-form-label">CURP:</label>
                                                    <b>@item.CURP</b><br />
                                                    <label for="recipient-name" class="col-form-label">NoExpediente:</label>
                                                    <b>@item.NoExpediente</b><br />
                                                    <label for="recipient-name" class="col-form-label">Fecha:</label>
                                                    <b>@Convert.ToDateTime(item.FechaCaptura).ToString("dd-MMMM-yyyy")</b><br />
                                                    <label for="recipient-name" class="col-form-label">Doctor:</label>
                                                    <b>@item.Doctor</b><br />
                                                    <label for="recipient-name" class="col-form-label">Tipo de Pago:</label>
                                                    <select required name="pago" style="width:100%; min-height:5vh; min-width:99%; font-size:2vh" class="form-select">
                                                        <option value="Referencia OXXO">Referencia OXXO</option>
                                                        <option value="Referencía BanBajío">Referencía BanBajío</option>
                                                        <option value="Transferencia vía BanBajío">Transferencia vía BanBajío</option>
                                                        <option value="Banorte">Banorte</option>
                                                        <option value="Santander">Santander</option>
                                                        <option value="BanCoppel TLS">BanCoppel TLS</option>
                                                        <option value="BanCoppel LC">BanCoppel LC</option>
                                                        <option value="Banco Azteca TLS">Banco Azteca TLS</option>
                                                        <option value="Banco Azteca LC">Banco Azteca LC</option>
                                                        <option value="Cuenta Externa">Cuenta Externa</option>
                                                        <option value="Credito Empresas">Credito Empresas</option>
                                                        <option value="Pendiente de Pago">Pendiente de Pago</option>
                                                    </select>
                                                    <br />
                                                    <label for="recipient-name" class="col-form-label">Fecha de pago contable:</label>
                                                    <input type="date" class="form-control" name="fechaContable" />
                                                    <label for="recipient-name" class="col-form-label">¿Desea agregar un comentario?:</label>
                                                    <input type="text" class="form-control" name="comentario" />
                                                    <input type="hidden" name="usuario" value="@oUser.Nombre" />
                                                    <input type="hidden" name="fechaInicio" value="@fechaInicio" />
                                                    <input type="hidden" name="fechaFinal" value="@fechaFinal" />
                                                    <input type="hidden" name="cuenta2" value="@cuenta" />
                                                    <input type="hidden" name="canal" value="@canal" />
                                                    <input type="hidden" name="sucursal" value="@sucursal" />
                                                </div>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                                                <input type="submit" value="Guardar" class="btn btn-primary" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </td>
                </tr>
                flag++;
            }
        }
    </table>
</div>




@*Tabla Invisible*@

<div class="tablaScroll" style="display: none">
    <table id="tbl_exporttable_to_xls" class="table  table-hover tablas" style="color: #2F2D6B; display: none">
        <thead style="color:white">
            <tr>
                <th>
                    Fecha Cita de Epi
                </th>
                <th>
                    Fecha de Captura
                </th>
                <th>
                    Fecha de Pago Contable
                </th>
                <th>
                    Fecha de Ultimo Movimiento Contable
                </th>
                <th>
                    Estatus de Captura
                </th>
                <th>
                    Nombre
                </th>
                <th>
                    Sucursal
                </th>
                <th>
                    ReferidoPor
                </th>
                <th>
                    Canal
                </th>
                <th>
                    Referencia
                </th>
                <th>
                    TipoPago
                </th>
                <th>
                    TipoLicencia
                </th>
                <th>
                    TipoTramite
                </th>
                <th>
                    Precio
                </th>
                <th>
                    Recepcionista
                </th>
                <th>
                    Cuenta
                </th>
                <th>
                    Movimientos de cuenta
                </th>
            </tr>
        </thead>

        @{
            modeloExcel = modeloExcel.OrderBy(q => q.A.M.FechaCita);
            foreach (var item in modeloExcel)
            {
                <tr>

                    @*FECHA DE CITA*@
                    <td>
                        <b>@item.A.M.FechaCita</b>
                    </td>

                    @*FECHA DE CAPTURA*@
                    <td>
                        <b>@item.B.FechaExpdiente</b>
                    </td>

                    @*FECHA DE PAGO CONTABLE*@
                    <td>
                        @if (item.A.M.FechaContable == null)
                        {
                            <span>------</span>
                        }
                        else
                        {
                            if (item.A.M.Cuenta == "BANCOS" || item.A.M.Cuenta == "CONEKTA")
                            {
                                @Convert.ToDateTime(item.A.M.FechaContable).AddDays(1).ToString("dd-MMMM-yyyy")
                            }
                        }
                    </td>

                    @*FECHA DE ULTIMO MOVIMIENTO CONTABLE*@
                    <td>
                        @if (item.A.M.FechaContable == null)
                        {
                            <span>------</span>
                        }
                        else
                        {
                            @Convert.ToDateTime(item.A.M.FechaContable).AddDays(1).ToString("dd-MMMM-yyyy")
                        }
                    </td>

                    @*ESTATUS DE CAPTURA*@
                    <td>
                        @item.B.EstatusCaptura
                    </td>

                    @*NOMBRE*@
                    <td>
                        <b>@item.A.N.Nombre</b>
                    </td>

                    @*SUCURSAL*@
                    <td>
                        @item.A.M.Sucursal
                    </td>

                    @*REFERIDO POR*@
                    <td>
                        <b>@item.A.M.ReferidoPor</b>
                    </td>

                    @*CANAL*@
                    <td>
                        <b>@item.A.M.CanalTipo</b>
                    </td>

                    @*REFERENCIA*@
                    <td>
                        <b>@item.A.M.Referencia</b>
                    </td>

                    @*TIPO PAGO*@
                    <td>
                        @{
                            if (item.A.M.TipoPago == "Referencia OXXO" || item.A.M.TipoPago == "Pago con Tarjeta")
                            {
                                <span>Conekta</span>
                            }
                            else if (item.A.M.TipoPago == "Referencía BanBajío" || item.A.M.TipoPago == "Transferencia vía BanBajío" || item.A.M.TipoPago == "Referencia BanBajío")
                            {
                                <span>BanBajío</span>
                            }
                            else
                            {
                                <span>@item.A.M.TipoPago</span>
                            }
                        }
                    </td>

                    @*TIPO LICENCIA*@
                    <td>
                        @item.A.M.TipoLicencia
                    </td>

                    @*TIPO TRAMITE*@
                    <td>
                        @item.A.M.TipoTramite
                    </td>

                    <td>
                        <b>$@item.A.M.PrecioEpi</b>
                    </td>

                    @*RECEPCIONISTA*@
                    <td>
                        @item.A.M.Recepcionista
                    </td>

                    @*CUENTA*@
                    <td>
                        @{
                            if (item.A.M.Cuenta == null)
                            {
                                <span>CAJA</span>
                            }
                            else
                            {
                                <span>@item.A.M.Cuenta</span>
                            }
                        }
                    </td>

                    @*MOVIMIENTOS DE LA CUENTA*@
                    <td>
                        @item.A.M.CuentaComentario
                    </td>

                </tr>
            }
        }

        @{
            foreach (var item in modeloExcel1.OrderBy(z => z.FechaCita))
            {
                <tr>

                    @*FECHA DE CITA*@
                    <td>
                        <b>@item.FechaCita</b>
                    </td>

                    @*FECHA DE CAPTURA*@
                    <td>
                        <b>@item.FechaCaptura</b>
                    </td>

                    @*FECHA DE PAGO CONTABLE*@
                    <td>
                        @if (item.FechaContable == null)
                        {
                            <span>------</span>
                        }
                        else
                        {
                            if (item.Cuenta == "BANCOS" || item.Cuenta == "CONEKTA")
                            {
                                @Convert.ToDateTime(item.FechaContable).AddDays(1).ToString("dd-MMMM-yyyy")
                            }
                        }
                    </td>

                    @*FECHA DE ULTIMO MOVIMIENTO CONTABLE*@
                    <td>
                        @if (item.FechaContable == null)
                        {
                            <span>------</span>
                        }
                        else
                        {
                            @Convert.ToDateTime(item.FechaContable).AddDays(1).ToString("dd-MMMM-yyyy")
                        }
                    </td>

                    @*ESTATUS DE CAPTURA*@
                    <td>
                        @item.EstatusCaptura
                    </td>

                    @*NOMBRE*@
                    <td>
                        <b>@item.Nombre</b>
                    </td>

                    @*SUCURSAL*@
                    <td>
                        ---
                    </td>

                    @*REFERIDO POR*@
                    <td>
                        <b>@item.ReferidoPor</b>
                    </td>

                    @*CANAL*@
                    <td>
                        <b>@item.CanalTipo</b>
                    </td>

                    @*REFERENCIA*@
                    <td>
                        ---
                    </td>

                    @*TIPO PAGO*@
                    <td>
                        @{
                            if (item.TipoPago == "Referencia OXXO" || item.TipoPago == "Pago con Tarjeta")
                            {
                                <span>Conekta</span>
                            }
                            else if (item.TipoPago == "Referencía BanBajío" || item.TipoPago == "Transferencia vía BanBajío" || item.TipoPago == "Referencia BanBajío")
                            {
                                <span>BanBajío</span>
                            }
                            else
                            {
                                <span>@item.TipoPago</span>
                            }
                        }
                    </td>

                    @*TIPO LICENCIA*@
                    <td>
                        @item.TipoLicencia
                    </td>

                    @*TIPO TRAMITE*@
                    <td>
                        @item.TipoTramite
                    </td>

                    <td>
                        <b>$@item.PrecioEpi</b>
                    </td>

                    @*RECEPCIONISTA*@
                    <td>
                        @item.Solicita
                    </td>

                    @*CUENTA*@
                    <td>
                        @{
                            if (item.Cuenta == null)
                            {
                                <span>CAJA</span>
                            }
                            else
                            {
                                <span>@item.Cuenta</span>
                            }
                        }
                    </td>

                    @*MOVIMIENTOS DE LA CUENTA*@
                    <td>
                        @item.CuentaComentario
                    </td>

                </tr>
            }

        }

    </table>
</div>


@section scripts
{
    @if (TempData["ID"] != null)
    {
        <script>
                window.open('@Url.Action("AbrirTicket2","Contabilidad", new { id = TempData["ID"] })');
        </script>
    }
}