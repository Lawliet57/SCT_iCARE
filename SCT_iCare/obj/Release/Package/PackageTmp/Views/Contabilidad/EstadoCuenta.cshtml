@*XLSX *@
<script type="text/javascript" src="https://unpkg.com/xlsx@0.15.1/dist/xlsx.full.min.js"></script>

@{
    ViewBag.Title = "EstadoCuenta";

    GMIEntities db = new GMIEntities();
    var oUser = (Usuarios)HttpContext.Current.Session["User"];

    //TAMAÑO DE LETRA EN TABLA DE TOTALES
    var Letra = "130%";

    //Fecha del mes.

    int inicioMes = 1;

    int diaMes = DateTime.Today.Day;
    int MES = DateTime.Today.Month;
    int ANIO = DateTime.Today.Year;
    DateTime fechaInicio = DateTime.Today;
    DateTime fechaFinal = DateTime.Today;


    DateTime FECHAI = new DateTime(Convert.ToInt32(ANIO), Convert.ToInt32(MES), inicioMes);
    DateTime FECHAF = new DateTime(Convert.ToInt32(ANIO), Convert.ToInt32(MES), diaMes);
    DateTime FECHAFS = new DateTime(Convert.ToInt32(ANIO), Convert.ToInt32(MES), diaMes);
    TimeSpan difFechas = FECHAF - fechaInicio;

    //VARIABLES DE VIEWBAGS PARA FILTROS
    string canal = "";
    string referido = "";

    //VARIABLES FECHA TABLA
    var fechaTabla = "";
    var fechaTablaAnterior = "";

    //EPIS NO PAGADOS
    int montoPxDia = 0;
    int precioVisual = 0;

    //EPIS PAGADOS
    int montoPxDiaP = 0;

    //PAGO DE GESTORES
    int pagoVisual = 0;
    var fechadePago = "";

    //PAGO DE GESTORES
    int pagoVisualMA = 0;
    var fechadePagoMA = "";

    //FOOTERS
    int totalEpis = 0;
    int saldoTotalImporte = 0;
    int totalEpisP = 0;
    int saldoTotalP = 0;
    int totalPago = 0;
    int diferenciaTotal = 0;

    //FOOTERS MES ANTERIOR
    int totalEpisMA = 0;
    int saldoTotalImporteMA = 0;
    int totalEpisPMA = 0;
    int montoTotalMa = 0;
    int montoTotalMaP = 0;
    int pagoMAPI = 0;

    //FECHA DE PAGOS GESTORES
    DateTime fechaPagosRow = DateTime.Today;


    //FECHA ACTUAL
    DateTime FechaAhora = DateTime.Now;

    string nombreExcel = "ESTADO DE CUENTA";


    if (ViewBag.FechaInicio != null)
    {
        fechaInicio = Convert.ToDateTime(ViewBag.FechaInicio);
        DateTime parset = fechaInicio.AddMonths(1).AddMinutes(-1);
    }

    else
    {

        fechaInicio = FECHAI;
        fechaFinal = FECHAF;
        FECHAFS = FECHAF;
        fechaFinal = fechaFinal.AddDays(1).AddMinutes(-1);

    }

    if (ViewBag.FechaFinal != null)
    {
        fechaFinal = Convert.ToDateTime(ViewBag.FechaFinal);
        FECHAFS = fechaFinal;
        fechaFinal = fechaFinal.AddDays(1).AddMinutes(-1);
    }

    else
    {

        fechaFinal = FECHAF;
        FECHAFS = FECHAF;
        fechaFinal = fechaFinal.AddDays(1).AddMinutes(-1);

    }

    DateTime fechaInicioMesA = fechaInicio.AddMonths(-1);
    DateTime fechaFinalMesA = fechaInicioMesA.AddMonths(1).AddMinutes(-1);


    //QUERYS TABLA REGISTROS MES ACTUAL

    var modeloNormal = db.Paciente.Join(db.Cita, n => n.idPaciente, m => m.idPaciente, (n, m) => new { N = n, M = m }).
    Join(db.Captura, a => a.M.idPaciente, b => b.idPaciente, (a, b) => new { A = a, B = b }).
    Where(s => s.B.EstatusCaptura == "Terminado" && s.A.M.Asistencia == null && s.A.M.FechaCita >= fechaInicio && s.A.M.FechaCita <= fechaFinal
    && s.A.M.TipoTramite != "REVALORACIÓN").OrderBy(o => o.A.M.Cuenta);


    var modeloAlternativo = db.PacienteESP.
    Where(s => s.EstatusCaptura == "Terminado" && s.FechaCita >= fechaInicio && s.FechaCita <= fechaFinal
    && s.TipoTramite != "REVALORACIÓN" && s.Asistencia == null).OrderBy(o => o.Cuenta);


    var modeloExcelNormal = db.Paciente.Join(db.Cita, n => n.idPaciente, m => m.idPaciente, (n, m) => new { N = n, M = m }).
        Join(db.Captura, a => a.M.idPaciente, b => b.idPaciente, (a, b) => new { A = a, B = b }).
        Where(s => s.B.EstatusCaptura == "Terminado" && s.A.M.Asistencia == null && s.A.M.FechaCita >= fechaInicio && s.A.M.FechaCita <= fechaFinal
        && s.A.M.TipoTramite != "REVALORACIÓN").OrderBy(o => o.A.M.Cuenta);


    var modeloExcelAlternativo = db.PacienteESP.
        Where(s => s.EstatusCaptura == "Terminado" && s.FechaCita >= fechaInicio && s.FechaCita <= fechaFinal
        && s.TipoTramite != "REVALORACIÓN" && s.Asistencia == null).OrderBy(o => o.Cuenta);

    var pagosGestores = db.PagosGestores;



    //QUERYS TABLA REGISTROS MES ANTERIOR

    var modeloNormalMA = db.Paciente.Join(db.Cita, n => n.idPaciente, m => m.idPaciente, (n, m) => new { N = n, M = m }).
    Join(db.Captura, a => a.M.idPaciente, b => b.idPaciente, (a, b) => new { A = a, B = b }).
    Where(s => s.B.EstatusCaptura == "Terminado" && s.A.M.Asistencia == null && s.A.M.FechaCita >= fechaInicioMesA && s.A.M.FechaCita <= fechaFinalMesA
    && s.A.M.TipoTramite != "REVALORACIÓN").OrderBy(o => o.A.M.Cuenta);


    var modeloAlternativoMA = db.PacienteESP.
        Where(s => s.EstatusCaptura == "Terminado" && s.FechaCita >= fechaInicioMesA && s.FechaCita <= fechaFinalMesA
        && s.TipoTramite != "REVALORACIÓN" && s.Asistencia == null).OrderBy(o => o.Cuenta);


    //QUERYS FILTROS

    //FILTRO CANAL

    if (ViewBag.Canal != "")
    {
        canal = ViewBag.Canal;

        //MODELO DE LOS NORMALES
        modeloNormal = modeloNormal.Where(w => w.B.EstatusCaptura == "Terminado" && w.A.M.Asistencia == null && w.A.M.TipoTramite != "REVALORACIÓN"
        && w.A.M.FechaCita >= fechaInicio && w.A.M.FechaCita <= fechaFinal && w.A.M.CanalTipo.Contains(canal)).OrderBy(o => o.A.M.Cuenta);

        //MODELO ALTERNATIVOS
        modeloAlternativo = modeloAlternativo.Where(w => w.EstatusCaptura == "Terminado" && w.TipoTramite != "REVALORACIÓN"
        && w.FechaCita >= fechaInicio && w.FechaCita <= fechaFinal && w.Asistencia == null && w.CanalTipo.Contains(canal)).OrderBy(o => o.Cuenta);

        //MODELO DE EXCEL NORMALES
        modeloExcelNormal = modeloExcelNormal.Where(w => w.B.EstatusCaptura == "Terminado" && w.A.M.Asistencia == null && w.A.M.TipoTramite != "REVALORACIÓN"
        && w.A.M.FechaCita >= fechaInicio && w.A.M.FechaCita <= fechaFinal && w.A.M.CanalTipo.Contains(canal)).OrderBy(o => o.A.M.Cuenta);

        //MODELO DE EXCEL ALTERNATIVOS
        modeloExcelAlternativo = modeloExcelAlternativo.Where(w => w.EstatusCaptura == "Terminado" && w.TipoTramite != "REVALORACIÓN"
        && w.FechaCita >= fechaInicio && w.FechaCita <= fechaFinal && w.Asistencia == null && w.CanalTipo.Contains(canal)).OrderBy(o => o.Cuenta);

        modeloNormalMA = modeloNormalMA.Where(w => w.B.EstatusCaptura == "Terminado" && w.A.M.Asistencia == null && w.A.M.TipoTramite != "REVALORACIÓN"
       && w.A.M.CanalTipo.Contains(canal)).OrderBy(o => o.A.M.Cuenta);

        modeloAlternativoMA = modeloAlternativoMA.Where(w => w.EstatusCaptura == "Terminado" && w.TipoTramite != "REVALORACIÓN"
        && w.Asistencia == null && w.CanalTipo.Contains(canal)).OrderBy(o => o.Cuenta);
    }


    //FILTRO REFERIDO

    int idReferido = ViewBag.idReferido;

    if (ViewBag.Referido != "" && ViewBag.idReferido != 0)
    {
        referido = ViewBag.Referido;

        //MODELO DE LOS NORMALES
        modeloNormal = modeloNormal.Where(w => w.B.EstatusCaptura == "Terminado" && w.A.M.Asistencia == null && w.A.M.TipoTramite != "REVALORACIÓN"
        && w.A.M.FechaCita >= fechaInicio && w.A.M.FechaCita <= fechaFinal && w.A.M.ReferidoPor.Contains(referido)).OrderBy(o => o.A.M.Cuenta);

        //MODELO ALTERNATIVOS
        modeloAlternativo = modeloAlternativo.Where(w => w.EstatusCaptura == "Terminado" && w.TipoTramite != "REVALORACIÓN"
        && w.FechaCita >= fechaInicio && w.FechaCita <= fechaFinal && w.Asistencia == null && w.ReferidoPor.Contains(referido)).OrderBy(o => o.Cuenta);

        //MODELO DE EXCEL NORMALES
        modeloExcelNormal = modeloExcelNormal.Where(w => w.B.EstatusCaptura == "Terminado" && w.A.M.Asistencia == null && w.A.M.TipoTramite != "REVALORACIÓN"
        && w.A.M.FechaCita >= fechaInicio && w.A.M.FechaCita <= fechaFinal && w.A.M.ReferidoPor.Contains(referido)).OrderBy(o => o.A.M.Cuenta);

        //MODELO DE EXCEL ALTERNATIVOS
        modeloExcelAlternativo = modeloExcelAlternativo.Where(w => w.EstatusCaptura == "Terminado" && w.TipoTramite != "REVALORACIÓN"
        && w.FechaCita >= fechaInicio && w.FechaCita <= fechaFinal && w.Asistencia == null && w.ReferidoPor.Contains(referido)).OrderBy(o => o.Cuenta);

        modeloNormalMA = modeloNormalMA.Where(w => w.B.EstatusCaptura == "Terminado" && w.A.M.Asistencia == null && w.A.M.TipoTramite != "REVALORACIÓN"
         && w.A.M.ReferidoPor.Contains(referido)).OrderBy(o => o.A.M.Cuenta);

        modeloAlternativoMA = modeloAlternativoMA.Where(w => w.EstatusCaptura == "Terminado" && w.TipoTramite != "REVALORACIÓN"
        && w.Asistencia == null && w.ReferidoPor.Contains(referido)).OrderBy(o => o.Cuenta);

    }
}




@*Referencia estilos para ambas tablas*@

<link rel="stylesheet" type="text/css" href="~/Estilo.css">

<img class="visible-print" src="~/Images/GA.png" style="width:90px; padding-top:12px; padding-bottom:10px; padding-right:20px; padding-left:20px;" hidden />


@*HEADER O ENCABEZADO*@
<br />
<h2 style="color: white"> Estado de Cuenta</h2>
@{
    if (referido != null && referido != "" && canal != null && canal != "")
    {
        <h5 style="color: white"> Mostrando resultados de: @referido del día @Convert.ToDateTime(fechaInicio).ToString("dd-MM-yy") al @Convert.ToDateTime(fechaFinal).ToString("dd-MM-yy")</h5>
        <br />
    }
}



@*INPUTS DE FILTROS*@
<form class="form-inline" method="post" enctype="multipart/form-data" action="@Url.Content("~/Contabilidad/EstadoCuenta")">
    <div class="hidden-print">

        @*INPUT FILTRO CANAL*@
        <select name="canal" style="font-size:1.5vh; width: 145px" class="form-control">
            @{
                if (ViewBag.Canal == "")
                {
                    <option value="">CANAL</option>
                }
                else
                {
                    <option value="@canal">@canal.ToUpper()</option>
                }
            }
            @{
                foreach (var item in db.Canales)
                {
                    <option value="@item.NombreCanal">@item.NombreCanal</option>
                }
            }
            <option value="">TODOS</option>
        </select>


        @*INPUT FILTRO REFERIDO*@
        <select name="referido" style="font-size: 1.5vh; width: 120px" class="form-control">
            @{
                if (ViewBag.Referido == "" || ViewBag.Referido == null)
                {
                    <option value="">REFERIDO POR</option>
                }
                else
                {
                    var refe = db.Referido.Where(s => s.Nombre == referido).FirstOrDefault();

                    <option value="@refe.idReferido">@referido.ToUpper()</option>
                }
            }
            @foreach (var item in db.Referido.OrderBy(o => o.Tipo).ThenBy(o => o.Nombre))
            {
                <option value="@item.idReferido">@item.Nombre -- @item.Tipo</option>
            }
            <option value="">TODOS</option>
        </select>


        @*INPUT FILTROS DE FECHA POR MES*@

        @{

            DateTime ViewBagFechaInicio = Convert.ToDateTime(ViewBag.fechaInicio);
            var SetFechaInicio = ViewBagFechaInicio.Date.ToString("yyyy-MM-dd");

            if (ViewBag.fechaInicio != null)
            {

                <input type="date" name="fechaInicio" class="form-control" value="@SetFechaInicio" style="width: 135px;" />

            }

            else

            {

                <input type="date" name="fechaInicio" class="form-control" value="" style="width: 135px;" />

            }

        }

        @{

            DateTime ViewBagFechaFinal = Convert.ToDateTime(ViewBag.fechaFinal);
            var SetFechaFinal = ViewBagFechaFinal.Date.ToString("yyyy-MM-dd");

            if (ViewBag.fechaFinal != null)
            {

                <input type="date" name="fechaFinal" class="form-control" value="@SetFechaFinal" style="width: 135px;" />

            }

            else

            {

                <input type="date" name="fechaFinal" class="form-control" value="" style="width: 135px;" />

            }

        }
        <input type="submit" class="btn btn-info" value="Enviar" />

        <a href="~/Contabilidad/EstadoCuenta">
            <span type="button" class="btn btn-success">Limpiar</span>
        </a>
    </div>
</form>


@*EXPORTAR PDF Y REGRESO A PAGOS*@
<script>
    function ExportToExcel(type, fn, dl)
    {
        var elt = document.getElementById('tbl_exporttable_to_xls');
        var wb = XLSX.utils.table_to_book(elt, { sheet: "sheet1" });
        return dl ?
            XLSX.write(wb, { bookType: type, bookSST: true, type: 'base64' }) :
            XLSX.writeFile(wb, fn || ('@nombreExcel' + ' del @Convert.ToDateTime(fechaInicio).ToString("dd-MM-yy")' + ' al @Convert.ToDateTime(fechaFinal).AddDays(-1).ToString("dd-MM-yy").' + (type || 'xlsx')));
    }
</script>



<!--<div class="hidden-print">
    <br />
    <a href="~/Contabilidad/Pagos">
        <span type="button" class="btn btn-success" style="background-color:dodgerblue">Regresar a Control de Pagos</span>
    </a>-->
@*<button style="background-color:limegreen" class="btn btn-info dropdown-toggle" onclick="ExportToExcel('xlsx')">Descargar reporte </button>*@
<!--</div>-->
<br />

@{
    if (referido != null && referido != "" && canal != null && canal != "")
    {
        <div class="hidden-print">
            <table style="max-width: 800px">
                <thead>
                    <tr style="font-size:smaller">
                        <th style="background-color: cornsilk;" scope="col">Gestor</th>
                        <th style="background-color: cornsilk;" scope="col">Precio EPI</th>
                        <th style="background-color: cornsilk;" scope="col">Precio EPI IVA</th>
                        <th style="background-color: cornsilk;" scope="col">Precio EPI Tripulación</th>
                        <th style="background-color: cornsilk;" scope="col">Precio EPI Tripulación IVA</th>
                        <th style="background-color: cornsilk;" scope="col">Precio EPI Pista</th>
                        <th style="background-color: cornsilk;" scope="col">Precio EPI Pista IVA</th>
                    </tr>
                </thead>
                <tbody>
                    @{ 
                        var findidRef = (from i in db.Referido where i.Nombre == referido && i.Tipo == canal select i).FirstOrDefault();
                    <tr style="background-color:whitesmoke; font-size:smaller">
                        <td>
                            @referido
                        </td>
                        <td>
                            $@Convert.ToInt32(findidRef.PrecioNormal).ToString("###,###,###,###")
                        </td>
                        <td>
                            $@Convert.ToInt32(findidRef.PrecioNormalconIVA).ToString("###,###,###,###")
                        </td>
                        <td>
                            $@Convert.ToInt32(findidRef.PrecioAereosinIVA).ToString("###,###,###,###")
                        </td>
                        <td>
                            $@Convert.ToInt32(findidRef.PrecioAereo).ToString("###,###,###,###")
                        </td>
                        <td>
                            $@Convert.ToInt32(findidRef.PrecioAereoPista).ToString("###,###,###,###")
                        </td>
                        <td>
                            $@Convert.ToInt32(findidRef.PrecioAereoPistaconIVA).ToString("###,###,###,###")
                        </td>
                    </tr>
                        }
                </tbody>
            </table>
             <br />
        </div>       
    }
}




@*TABLA INICIAL/ TABLA QUE DICE ALTERNATIVOS/ENCABEZADOS DE LAS DEMAS TABLAS*@
<div>
    <table>
        <thead>
            <tr>
                <th style="background-color:lightskyblue;" scope="col">Fecha</th>
                <th style="background-color: lightskyblue;" scope="col"># Epis</th>
                <th style="background-color: lightskyblue;" scope="col">Importe</th>
                <th style="background-color: lightskyblue;" scope="col"># Epis Pagados</th>
                <th style="background-color: lightskyblue;" scope="col">Importe Conciliación</th>
                <th style="background-color: lightskyblue;" scope="col">Importe Pagos</th>
                <th style="background-color: lightskyblue;" scope="col">Saldo</th>
            </tr>
        </thead>
    </table>
</div>



@*TABLA PRIMERA SECCION PAGOS SALDO POR MES ANTERIOR*@
@{
    if (fechaInicioMesA.Month >= 7 && fechaInicioMesA.Year >= 2022 && ViewBag.Referido != null && ViewBag.Referido != "" && canal != "IN SITU" && canal != "GESTOR ALT" && canal != null && canal != "")
    {
        var epiFinalMA = (from i in modeloNormalMA where i.A.M.FechaCita >= fechaInicioMesA && i.A.M.FechaCita <= fechaFinalMesA select i).OrderByDescending(q => q.A.M.FechaCita).FirstOrDefault();
        var epiFinalMACOUNT = (from i in modeloNormalMA where i.A.M.FechaCita >= fechaInicioMesA && i.A.M.FechaCita <= fechaFinalMesA select i).Count();
        var epiFinalMATotal = (from i in modeloNormalMA where i.A.M.FechaCita >= fechaInicioMesA && i.A.M.FechaCita <= fechaFinalMesA select i);
        var epiFinalMATotalP = (from i in modeloNormalMA where i.A.M.FechaCita >= fechaInicioMesA && i.A.M.FechaCita <= fechaFinalMesA && (i.A.M.Cuenta == "BANCOS" || i.A.M.Cuenta == "CONEKTA") select i);


        if (epiFinalMACOUNT != 0)
        {
            //TOTALES DE EPIS
            foreach (var zero in epiFinalMATotal)
            {
                montoTotalMa += Convert.ToInt32(zero.A.M.PrecioEpi);
            }

            //TOTALES DE EPIS PAGADOS
            foreach (var zeroP in epiFinalMATotalP)
            {
                montoTotalMaP += Convert.ToInt32(zeroP.A.M.PrecioEpi);
            }

            //VARIABLES PARA FECHAS
            var fechaTablaMA = Convert.ToDateTime(epiFinalMA.A.M.FechaCita).ToString("dd-MMMM-yy");
            DateTime fechaInicioDiaMA = Convert.ToDateTime(fechaTablaMA);
            DateTime fechaFinalDiaMA = fechaInicioDiaMA.AddHours(23).AddMinutes(59);

            //CONTEO DE EPIS TOTALES MES ANTERIOR
            int conteoEpisTotalesMA = (from i in modeloNormalMA where i.A.M.FechaCita >= fechaInicioMesA && i.A.M.FechaCita <= fechaFinalMesA select i).Count();

            //CONTEO DE EPIS PAGADOS
            int conteoEpisPTotalesMA = (from i in modeloNormalMA where i.A.M.FechaCita >= fechaInicioMesA && i.A.M.FechaCita <= fechaFinalMesA && (i.A.M.Cuenta == "BANCOS" || i.A.M.Cuenta == "CONEKTA") select i).Count();

            //VARIABLES PARA PAGOS EFECTUADOS EN MODULO DE PAGOS
            var pagoGestor = (from i in pagosGestores where i.Gestor == epiFinalMA.A.M.ReferidoPor && i.Fecha >= fechaInicioMesA && i.Fecha <= fechaFinalMesA select i);

            foreach (var zeroMAPI in pagoGestor)
            {
                pagoMAPI += Convert.ToInt32(zeroMAPI.PagoIngresado);
            }

            <table cellpadding="0" cellspacing="0" class="table  table-hover tablas table-bordered" style="color: #2F2D6B">
                <thead style="color:white">
                    <tr>
                        <th style="background-color: gray;" colspan="2"></th>
                        <th style="background-color: gray; " colspan="3">Operaciones de @fechaInicioMesA.ToString("MMMM")</th>
                        <th style="background-color: gray; " colspan="2"></th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        @*FECHA DE CITA*@
                        <td>
                            <span>@fechaTablaMA</span>
                        </td>

                        @*NUMERO DE EPIS X DIA EN FECHA*@
                        @{
                            var findidRef = (from i in db.Referido where i.Nombre == referido && i.Tipo == canal select i).FirstOrDefault();
                            var fechaFinalSimulada = fechaFinalMesA.AddDays(-1);
                            <td>
                                <div class="hidden-print">
                                    <a href=@Url.Action("Index", "Contabilidad", new { canal = canal, fechaInicio = fechaInicioMesA, fechaFinal = fechaFinalSimulada, referido = findidRef.idReferido }) style="color:navy; text-decoration:none">
                                    <span>@conteoEpisTotalesMA</span>
                                    </a>
                                 </div>
                            </td>
                        }

                        @*IMPORTE*@
                        @{
                            <td>
                                <span>@montoTotalMa.ToString("###,###,###,###")</span>
                            </td>
                            montoTotalMa = 0;
                        }

                        @*EPIS PAGADOS*@

                        <td>
                            <span>@conteoEpisPTotalesMA</span>
                        </td>

                        @*IMPORTE EPIS PAGADOS*@
                        @{
                            <td>
                                <span>@montoTotalMaP.ToString("###,###,###,###")</span>
                            </td>
                            montoTotalMaP = 0;
                        }

                        @*IMPORTE MODULO DE PAGOS*@
                        @{
                            <td>
                                <span>@pagoMAPI.ToString("###,###,###,###")</span>
                            </td>
                            pagoMAPI = 0;
                        }

                        <td>
                        </td>


                    </tr>
                </tbody>
            </table>
        }
    }

    else if (fechaInicioMesA.Month >= 7 && fechaInicioMesA.Year >= 2022 && ViewBag.Referido != null && ViewBag.Referido != "" && (canal != "IN SITU" || canal == "GESTOR ALT" && canal != null && canal != ""))
    {
        var epiFinalMA = (from i in modeloAlternativoMA where i.FechaCita >= fechaInicioMesA && i.FechaCita <= fechaFinalMesA select i).OrderByDescending(q => q.FechaCita).FirstOrDefault();
        var epiFinalMACOUNT = (from i in modeloAlternativoMA where i.FechaCita >= fechaInicioMesA && i.FechaCita <= fechaFinalMesA select i).Count();
        var epiFinalMATotal = (from i in modeloAlternativoMA where i.FechaCita >= fechaInicioMesA && i.FechaCita <= fechaFinalMesA select i);
        var epiFinalMATotalP = (from i in modeloAlternativoMA where i.FechaCita >= fechaInicioMesA && i.FechaCita <= fechaFinalMesA && (i.Cuenta == "BANCOS" || i.Cuenta == "CONEKTA") select i);


        if (epiFinalMACOUNT != 0)
        {

            //TOTALES DE EPIS
            foreach (var zero in epiFinalMATotal)
            {
                montoTotalMa += Convert.ToInt32(zero.PrecioEpi);
            }

            //TOTALES DE EPIS PAGADOS
            foreach (var zeroP in epiFinalMATotalP)
            {
                montoTotalMaP += Convert.ToInt32(zeroP.PrecioEpi);
            }

            //VARIABLES PARA FECHAS
            var fechaTablaMA = Convert.ToDateTime(epiFinalMA.FechaCita).ToString("dd-MMMM-yy");
            DateTime fechaInicioDiaMA = Convert.ToDateTime(fechaTablaMA);
            DateTime fechaFinalDiaMA = fechaInicioDiaMA.AddHours(23).AddMinutes(59);

            //CONTEO DE EPIS TOTALES MES ANTERIOR
            int conteoEpisTotalesMA = (from i in modeloAlternativoMA where i.FechaCita >= fechaInicioMesA && i.FechaCita <= fechaFinalMesA select i).Count();

            //CONTEO DE EPIS PAGADOS
            int conteoEpisPTotalesMA = (from i in modeloAlternativoMA where i.FechaCita >= fechaInicioMesA && i.FechaCita <= fechaFinalMesA && (i.Cuenta == "BANCOS" || i.Cuenta == "CONEKTA") select i).Count();

            //VARIABLES PARA PAGOS EFECTUADOS EN MODULO DE PAGOS
            var pagoGestor = (from i in pagosGestores where i.Gestor == epiFinalMA.ReferidoPor && i.Fecha >= fechaInicioMesA && i.Fecha <= fechaFinalMesA select i);

            foreach (var pagos in pagoGestor)
            {
                pagoVisualMA += Convert.ToInt32(pagos.PagoIngresado);
                fechadePagoMA = Convert.ToDateTime(pagos.Fecha).ToString("dd-MMMM-yy");
            }

            <table cellpadding="0" cellspacing="0" class="table  table-hover tablas table-bordered" style="color: #2F2D6B">
                <thead style="color:white">
                    <tr>
                        <th style="background-color: gray;" colspan="2"></th>
                        <th style="background-color: gray; " colspan="3">Operaciones de @fechaInicioMesA.ToString("MMMM")</th>
                        <th style="background-color: gray; " colspan="2"></th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        @*FECHA DE CITA*@
                        <td>
                            <span>@fechaTablaMA</span>
                        </td>

                        @*NUMERO DE EPIS X DIA EN FECHA*@
                        @{
                            var findidRef = (from i in db.Referido where i.Nombre == referido && i.Tipo == canal select i).FirstOrDefault();
                            var fechaFinalSimulada = fechaFinalMesA.AddDays(-1);
                            <td><a class="hidden-print" href=@Url.Action("Index", "Contabilidad", new { canal = canal, fechaInicio = fechaInicioMesA, fechaFinal = fechaFinalSimulada, referido = findidRef.idReferido }) style="color:navy; text-decoration:none"><span class="visible-print">@conteoEpisTotalesMA</span></a></td>
                        }

                        @*IMPORTE*@
                        @{
                            <td>
                                <span>@montoTotalMa.ToString("###,###,###,###")</span>
                            </td>
                            montoTotalMa = 0;
                        }

                        @*EPIS PAGADOS*@

                        <td>
                            <span>@conteoEpisPTotalesMA</span>
                        </td>

                        @*IMPORTE EPIS PAGADOS*@
                        @{
                            <td>
                                <span>@montoTotalMaP.ToString("###,###,###,###")</span>
                            </td>
                            montoTotalMaP = 0;
                        }

                        @*IMPORTE MODULO DE PAGOS*@
                        @{
                            <td>
                                <span>@pagoMAPI.ToString("###,###,###,###")</span>
                            </td>
                            pagoMAPI = 0;
                        }

                        <td>
                        </td>

                    </tr>
                </tbody>
            </table>
        }
    }
}


@*TABLA DE PAGOS DEL MES ACTUAL NORMALES*@
@{
    if (canal != "IN SITU" && canal != "GESTOR ALT" && canal != null && canal != "" && referido != null && referido != "")
    {
        <div>
            <table cellpadding="0" cellspacing="0" class="table  table-hover tablas table-bordered" style="color: #2F2D6B">
                <thead style="color:white">
                    <tr>
                        <th style="background-color: gray;" colspan="2"></th>
                        <th style="background-color: gray; " colspan="3">Operaciones de @fechaInicio.ToString("MMMM")</th>
                        <th style="background-color: gray; " colspan="2"></th>
                    </tr>
                </thead>
                <tbody>
                    @{
                        var ultimaFecha = (from i in modeloNormal select i).OrderByDescending(o => o.A.M.FechaCita).FirstOrDefault();
                        DateTime fechadeultimoepi = FECHAI;
                        if (ultimaFecha != null)
                        {
                            fechadeultimoepi = Convert.ToDateTime(ultimaFecha.A.M.FechaCita);
                        }
                        var findidRef = (from i in db.Referido where i.Nombre == referido && i.Tipo == canal select i).FirstOrDefault();
                        var ultimaFechaPagos = (from i in pagosGestores where i.idReferido == findidRef.idReferido && i.Fecha >= fechaInicio && i.Fecha <= fechaFinal select i).OrderByDescending(o => o.Fecha).FirstOrDefault();
                        DateTime fechadeultimopago = FECHAI;
                        if (ultimaFechaPagos != null)
                        {
                            fechadeultimopago = Convert.ToDateTime(ultimaFechaPagos.Fecha);
                        }
                        var preciodesumasnofechas = 0;
                        var saldoRowAnterior = 0;

                        foreach (var item in modeloNormal.OrderBy(q => q.A.M.FechaCita))
                        {
                            //VARIABLES PARA FECHAS
                            fechaTabla = Convert.ToDateTime(item.A.M.FechaCita).ToString("dd-MMMM-yy");
                            var parseFechaInicial = DateTime.Parse(fechaTabla);
                            var parseFechaFinal = DateTime.Parse(fechaTabla).AddHours(23).AddMinutes(59);

                            //CONTEO DE EPIS TOTALES
                            int conteoEpisTotales = (from i in modeloNormal where i.A.M.FechaCita >= parseFechaInicial && i.A.M.FechaCita <= parseFechaFinal select i).Count();
                            var episXDia = (from i in modeloNormal where i.A.M.FechaCita >= parseFechaInicial && i.A.M.FechaCita <= parseFechaFinal select i);
                            var episXDiaP = (from i in modeloNormal where i.A.M.FechaCita >= parseFechaInicial && i.A.M.FechaCita <= parseFechaFinal && (i.A.M.Cuenta == "BANCOS" || i.A.M.Cuenta == "CONEKTA") select i);

                            //CONTEO DE EPIS TOTALES PAGADOS
                            int conteoEpisPTotales = (from i in modeloNormal where i.A.M.FechaCita >= parseFechaInicial && i.A.M.FechaCita <= parseFechaFinal && (i.A.M.Cuenta == "BANCOS" || i.A.M.Cuenta == "CONEKTA") select i).Count();

                            //VARIABLES PARA PAGOS EFECTUADOS EN MODULO DE PAGOS
                            var referidoPagos = (from i in db.Referido where i.Nombre == item.A.M.ReferidoPor && i.Tipo == item.A.M.CanalTipo select i).FirstOrDefault();
                            var pagoGestor = (from i in pagosGestores where i.Gestor == item.A.M.ReferidoPor && i.idReferido == referidoPagos.idReferido && i.Fecha >= parseFechaInicial && i.Fecha <= parseFechaFinal select i);
                            var pagoGestorC = (from i in pagosGestores where i.Gestor == item.A.M.ReferidoPor && i.Fecha >= parseFechaInicial && i.Fecha <= parseFechaFinal select i).Count();
                            var condicionante = "";
                            var pagodeRow = 0;

                            //VARIABLE PARA ROW DE PAGOS
                            if (fechaTablaAnterior != "")
                            {
                                var fechaRow = DateTime.Parse(fechaTablaAnterior).AddDays(1);
                                var pagoGestorRow = (from i in pagosGestores where i.Gestor == item.A.M.ReferidoPor && i.idReferido == referidoPagos.idReferido && i.Fecha >= fechaRow && i.Fecha <= parseFechaInicial select i).OrderBy(o => o.Fecha);
                                var pagoGestorRowCount = (from i in pagosGestores where i.Gestor == item.A.M.ReferidoPor && i.idReferido == referidoPagos.idReferido && i.Fecha >= fechaRow && i.Fecha <= parseFechaInicial select i).Count();

                                if (pagoGestorRowCount != 0)
                                {
                                    condicionante = "Si";

                                    foreach (var i in pagoGestorRow)
                                    {
                                        var getFecha = Convert.ToDateTime(i.Fecha).ToString("dd-MMMM-yy");
                                        fechaPagosRow = DateTime.Parse(getFecha);
                                        pagodeRow += Convert.ToInt32(i.PagoIngresado);
                                    }
                                }
                            }

                            //ROW DE PAGO SI ES DIFERENTE A FECHA TABLA PASADA

                            if (condicionante == "Si")
                            {
                                var comparacion = Convert.ToDateTime(fechaPagosRow).ToString("dd-MMMM-yy");

                                if (fechaTablaAnterior != comparacion)
                                {
                                    <tr style="height: auto">

                                        @*FECHA DE CITA*@
                                        <td>
                                            <span>@Convert.ToDateTime(fechaPagosRow).ToString("dd-MMMM-yy")</span>
                                        </td>

                                        @*NUMERO DE EPIS X DIA EN FECHA*@
                                        <td>
                                        </td>

                                        @*IMPORTE*@
                                        <td>
                                        </td>

                                        @*EPIS PAGADOS*@

                                        <td>
                                        </td>

                                        @*IMPORTE EPIS PAGADOS*@

                                        <td>
                                        </td>

                                        @*IMPORTE MODULO DE PAGOS*@

                                        <td>
                                            <span>$@pagodeRow.ToString("###,###,###,###")</span>
                                        </td>

                                         @*SALDOS*@
                                            @{
                                                saldoRowAnterior = saldoRowAnterior + pagodeRow;

                                                if (saldoRowAnterior < 0)
                                                {
                                                    var muestrasaldo = saldoRowAnterior * (-1);
                                                    <td>
                                                        <span>$(@muestrasaldo.ToString("###,###,###,###"))</span>
                                                    </td>
                                                }
                                                else
                                                { 
                                                    <td>
                                                        <span>$@saldoRowAnterior.ToString("###,###,###,###")</span>
                                                    </td>
                                                }                                                
                                            }
                                    </tr>

                                    montoPxDia = 0;
                                    montoPxDiaP = 0;
                                    precioVisual = 0;
                                    pagoVisual = 0;
                                    condicionante = "";

                                }
                            }

                            //CONDICIONANTE DE FECHAS DE EPIS

                            if (fechaTablaAnterior != fechaTabla)
                            {
                                totalEpis = (from i in modeloNormal select i).Count();

                                //SUMA DE PRECIOS EPIS X DIA
                                foreach (var precio in episXDia)
                                {
                                    montoPxDia += Convert.ToInt32(precio.A.M.PrecioEpi);
                                }

                                //SUMA DE PRECIOS PAGADOS EPIS X DIA
                                foreach (var precio in episXDiaP)
                                {
                                    montoPxDiaP += Convert.ToInt32(precio.A.M.PrecioEpi);
                                }

                                saldoTotalImporte += montoPxDia;
                                saldoTotalP += montoPxDiaP;
                                totalEpisP = (from i in modeloNormal where (i.A.M.Cuenta == "BANCOS" || i.A.M.Cuenta == "CONEKTA") select i).Count();

                                foreach (var pagos in pagoGestor)
                                {
                                    pagoVisual += Convert.ToInt32(pagos.PagoIngresado);
                                    fechadePago = Convert.ToDateTime(pagos.Fecha).ToString("dd-MMMM-yy");
                                }

                                totalPago += pagoVisual;
                                diferenciaTotal = saldoTotalImporte - (saldoTotalP + totalPago);

                                <tr style="height: auto">

                                    @*FECHA DE CITA*@
                                    <td>
                                        <span>@fechaTabla</span>
                                    </td>

                                    @*NUMERO DE EPIS X DIA EN FECHA*@
                                    @{
                                        var fechaTablaInicioDia = Convert.ToDateTime(fechaTabla);
                                        var fechaTablaFinalDia = Convert.ToDateTime(fechaTabla).AddMinutes(-1);
                                        <td>
                                            <div>
                                                <a class="hidden-print" href=@Url.Action("Index", "Contabilidad", new { canal = canal, fechaInicio = fechaTablaInicioDia, fechaFinal = fechaTablaFinalDia, referido = findidRef.idReferido }) style="color:navy; text-decoration:none">
                                                    <span>@conteoEpisTotales</span>
                                                </a>
                                                <span class="visible-print" hidden>@conteoEpisTotales</span>
                                            </div>
                                        </td>
                                    }

                                    @*IMPORTE*@
                                    <td>
                                        <span>$@montoPxDia.ToString("###,###,###,###")</span>
                                    </td>

                                    @*EPIS PAGADOS*@

                                    @{
                                        if (conteoEpisPTotales != 0)
                                        {
                                            <td>
                                                <span>@conteoEpisPTotales</span>
                                            </td>
                                        }
                                        else
                                        {
                                            <td>
                                            </td>
                                        }
                                    }

                                    @*IMPORTE EPIS PAGADOS*@

                                    @{
                                        if (conteoEpisPTotales != 0)
                                        {
                                            <td>
                                                <span>$@montoPxDiaP.ToString("###,###,###,###")</span>
                                            </td>
                                        }
                                        else
                                        {
                                            <td>
                                            </td>
                                        }
                                    }

                                    @*IMPORTE MODULO DE PAGOS*@

                                    @{
                                        if (fechaTabla == fechadePago)
                                        {
                                            <td>
                                                <span>$@pagoVisual.ToString("###,###,###,###")</span>
                                            </td>
                                        }
                                        else
                                        {
                                            <td>
                                            </td>
                                        }

                                    }

                                    @*SALDOS*@
                                    @{
                                        var sumaPositivos = montoPxDiaP + pagoVisual;
                                        var saldoensaldos = sumaPositivos - montoPxDia;

                                        if (saldoRowAnterior == 0)
                                        {
                                            saldoRowAnterior = saldoensaldos;
                                        }

                                        else if(saldoRowAnterior < 0)
                                        {
                                            if (saldoensaldos < 0)
                                            {
                                                saldoRowAnterior = saldoRowAnterior + saldoensaldos;
                                            }
                                            else
                                            {
                                                saldoRowAnterior = saldoRowAnterior + saldoensaldos;
                                            }
                                        }

                                        else
                                        {
                                            if(saldoensaldos < 0)
                                            {
                                                saldoRowAnterior = saldoRowAnterior + saldoensaldos;
                                            }
                                            else
                                            {
                                                saldoRowAnterior = saldoRowAnterior + saldoensaldos;
                                            }
                                        }

                                        if (saldoRowAnterior < 0)
                                        {
                                            var muestradesaldo = saldoRowAnterior * (-1);
                                                <td>
                                                    <span>$(@muestradesaldo.ToString("###,###,###,###"))</span>
                                                </td>
                                            }
                                            else
                                            {
                                                <td>
                                                    <span>$@saldoRowAnterior.ToString("###,###,###,###")</span>
                                                </td>
                                            }

                                            saldoensaldos = 0;

                                        }
                                </tr>

                                fechaTablaAnterior = fechaTabla;
                                montoPxDia = 0;
                                montoPxDiaP = 0;
                                precioVisual = 0;
                                pagoVisual = 0;
                                totalPago += pagodeRow;
                            }
                        }

                        //ROW DE PAGO SI ES DIFERENTE A FECHA TABLA PASADA
                        var fechaUEPI = Convert.ToDateTime(fechadeultimoepi).ToString("dd-MMMM-yy");
                        DateTime fechaUEPI2 = Convert.ToDateTime(fechaUEPI);
                        var fechaUPAGO = Convert.ToDateTime(fechadeultimopago).ToString("dd-MMMM-yy");
                        DateTime fechaUPAGO2 = Convert.ToDateTime(fechaUPAGO);

                        if (fechaUEPI2 < fechaUPAGO2 )
                        {
                               var fechasDePagosjaja = (from i in pagosGestores where i.idReferido == findidRef.idReferido && i.Fecha > fechadeultimoepi && i.Fecha <= fechadeultimopago select i);                               

                               foreach(var i in fechasDePagosjaja)
                               {
                                    preciodesumasnofechas += Convert.ToInt32(i.PagoIngresado);
                               }

                                <tr style="height: auto">

                                    @*FECHA DE CITA*@
                                    <td>
                                        <span>@Convert.ToDateTime(fechadeultimopago).ToString("dd-MMMM-yy")</span>
                                    </td>

                                    @*NUMERO DE EPIS X DIA EN FECHA*@
                                    <td>
                                    </td>

                                    @*IMPORTE*@
                                    <td>
                                    </td>

                                    @*EPIS PAGADOS*@

                                    <td>
                                    </td>

                                    @*IMPORTE EPIS PAGADOS*@

                                    <td>
                                    </td>

                                    @*IMPORTE MODULO DE PAGOS*@

                                    <td>
                                        <span>$@preciodesumasnofechas.ToString("###,###,###,###")</span>
                                    </td>

                                    @*SALDO*@
                                    @{ 
                                        saldoRowAnterior = saldoRowAnterior + preciodesumasnofechas;

                                        if(saldoRowAnterior < 0)
                                        {
                                            var muestrasaldo = saldoRowAnterior * (-1);
                                            <td>
                                                <span>$(@muestrasaldo.ToString("###,###,###,###"))</span>
                                            </td>
                                        }
                                        else
                                        { 
                                            <td>
                                                <span>$@saldoRowAnterior.ToString("###,###,###,###")</span>
                                            </td>
                                        }                                
                                    }
                                </tr> 
                                totalPago += preciodesumasnofechas;
                                diferenciaTotal =  saldoTotalImporte - (saldoTotalP + totalPago);
                                preciodesumasnofechas=0;
                        }

                        <tr>

                            @*FECHA DE CITA*@
                            <td>
                            </td>

                            @*NUMERO DE EPIS X DIA EN FECHA*@
                            <td>
                            </td>

                            @*IMPORTE*@
                            <td>
                            </td>

                            @*EPIS PAGADOS*@
                            <td>
                            </td>

                            @*IMPORTE EPIS PAGADOS*@

                            <td>
                            </td>

                            @*IMPORTE MODULO DE PAGOS*@

                            <td>
                            </td>

                            @*BANCOS*@

                            <td>
                            </td>

                        </tr>
                    }
                </tbody>
            </table>

            @{
                if (fechaTabla != null && fechaTabla != "")
                {
                    <table cellpadding="0" cellspacing="0" class="table  table-hover tablas table-bordered" style="background-color:transparent; border-color:transparent">
                        <thead style="border: none; background-color:transparent">
                            <tr style="border: none; background-color:transparent">

                                @*FOOTTER  MES ACTUAL*@
                                <th style="background-color: aliceblue; border: none; background-color:transparent"><b style="color:aliceblue; font-size: @Letra">@Convert.ToDateTime(fechaTabla).ToString("MMMM").ToUpper()</b></th>


                                @*FOOTTER  EPIS TOTALES*@
                                <th style="background-color: aliceblue; border: none; background-color:transparent"><b style="color:aliceblue; font-size: @Letra">@totalEpis</b></th>


                                @*FOOTTER  IMPORTE TOTAL*@
                                <th style="background-color: aliceblue; border: none; background-color:transparent"><b style="color:aliceblue; font-size: @Letra">$@saldoTotalImporte.ToString("###,###,###,###")</b></th>


                                @*FOOTTER  EPIS CONCILIADOS TOTALES*@
                                @{
                                    if (totalEpisP != 0)
                                    {
                                        <th style="background-color: aliceblue; border: none; background-color:transparent"><b style="color:aliceblue; font-size: @Letra">@totalEpisP</b></th>
                                    }
                                    else
                                    {
                                        <th style="background-color: aliceblue; border: none; background-color:transparent"><b style="color:aliceblue; font-size: @Letra"></b></th>
                                    }
                                }

                                @*FOOTTER IMPORTE DE  EPIS CONCILIADOS TOTALES*@
                                @{
                                    if (saldoTotalP != 0)
                                    {
                                        <th style="background-color: aliceblue; border: none; background-color:transparent"><b style="color:aliceblue; font-size: @Letra">$@saldoTotalP.ToString("###,###,###,###")</b></th>
                                    }
                                    else
                                    {
                                        <th style="background-color: aliceblue; border: none; background-color:transparent"><b style="color:aliceblue; font-size: @Letra"></b></th>
                                    }
                                }

                                @*FOOTTER  PAGOS INGRESADOS TOTALES*@
                                @{
                                    if (totalPago != 0)
                                    {
                                        <th style="background-color: aliceblue; border: none; background-color:transparent"><b style="color:aliceblue; font-size:@Letra">$@totalPago.ToString("###,###,###,###")</b></th>
                                    }
                                    else
                                    {
                                        <th style="background-color: aliceblue; border: none; background-color:transparent"><b style="color:aliceblue; font-size: @Letra"></b></th>
                                    }
                                }

                                @*FOOTTER  DIFERENCIA DE PAGOS*@
                                @{
                                    if (diferenciaTotal != 0)
                                    {
                                        if (diferenciaTotal > 0)
                                        {
                                            <th style="background-color: aliceblue; border: none; background-color:transparent"><b style="color:aliceblue; font-size:@Letra">($@diferenciaTotal.ToString("###,###,###,###"))</b></th>
                                        }
                                        else if (diferenciaTotal < 0)
                                        {
                                            diferenciaTotal = diferenciaTotal * (-1);
                                            <th style="background-color: aliceblue; border: none; background-color:transparent"><b style="color:aliceblue; font-size:@Letra">$@diferenciaTotal.ToString("###,###,###,###")</b></th>
                                        }
                                    }
                                    else
                                    {
                                        <th style="background-color: aliceblue; border: none; background-color:transparent"><b style="color:aliceblue; font-size: @Letra"></b></th>
                                    }
                                }
                            </tr>
                        </thead>

                        @*DIFERENCIAS DE MES*@
                        <tbody>
                            <tr style="border: none; background-color:transparent">

                                @*FOOTTER  MES PASADO*@
                                <th style="background-color: aliceblue; border: none; background-color:transparent"><b style="color:aliceblue; font-size: @Letra">Sumas:</b></th>


                                @*FOOTTER  EPIS TOTALES PASADO*@

                                @{var finalTotal = totalEpis + totalEpisMA;
                                    <th style="background-color: aliceblue; border: none; background-color:transparent"><b style="color:aliceblue; font-size: @Letra">@finalTotal</b></th>
                                }

                                @*FOOTTER  IMPORTE TOTAL PASADO*@

                                @{var importeTotal = saldoTotalImporte + saldoTotalImporteMA;
                                    <th style="background-color: aliceblue; border: none; background-color:transparent"><b style="color:aliceblue; font-size: @Letra">$@importeTotal.ToString("###,###,###,###")</b></th>
                                }

                                @*FOOTTER  EPIS CONCILIADOS TOTALES PASADO*@
                                @{var episPTotales = totalEpisP + totalEpisPMA;
                                    if (totalEpisP != 0)
                                    {
                                        <th style="background-color: aliceblue; border: none; background-color:transparent"><b style="color:aliceblue; font-size: @Letra">@episPTotales</b></th>
                                    }
                                    else
                                    {
                                        <th style="background-color: aliceblue; border: none; background-color:transparent"><b style="color:aliceblue; font-size: @Letra"></b></th>
                                    }
                                }

                                @*FOOTTER IMPORTE DE  EPIS CONCILIADOS TOTALES PASADO*@
                                @{
                                    var totalPagado = saldoTotalP + montoTotalMaP;
                                    if (saldoTotalP != 0)
                                    {
                                        <th style="background-color: aliceblue; border: none; background-color:transparent"><b style="color:aliceblue; font-size: @Letra">$@totalPagado.ToString("###,###,###,###")</b></th>
                                    }
                                    else
                                    {
                                        <th style="background-color: aliceblue; border: none; background-color:transparent"><b style="color:aliceblue; font-size: @Letra"></b></th>
                                    }
                                }

                                @*FOOTTER  PAGOS INGRESADOS TOTALES PASADO*@
                                @{
                                    if (totalPago != 0)
                                    {
                                        <th style="background-color: aliceblue; border: none; background-color:transparent"><b style="color:aliceblue; font-size:@Letra">$@totalPago.ToString("###,###,###,###")</b></th>
                                    }
                                    else
                                    {
                                        <th style="background-color: aliceblue; border: none; background-color:transparent"><b style="color:aliceblue; font-size: @Letra"></b></th>
                                    }
                                }

                                @*FOOTTER  DIFERENCIA DE PAGOS PASADO*@
                                @{
                                    if (diferenciaTotal != 0)
                                    {
                                        if (diferenciaTotal < 0)
                                        {
                                            diferenciaTotal = diferenciaTotal * (-1);
                                            <th style="background-color: aliceblue; border: none; background-color:transparent"><b style="color:aliceblue; font-size:@Letra">($@diferenciaTotal.ToString("###,###,###,###"))</b></th>
                                        }
                                        else if (diferenciaTotal < 0)
                                        {
                                            <th style="background-color: aliceblue; border: none; background-color:transparent"><b style="color:aliceblue; font-size:@Letra">$@diferenciaTotal.ToString("###,###,###,###")</b></th>
                                        }
                                    }
                                    else
                                    {
                                        <th style="background-color: aliceblue; border: none; background-color:transparent"><b style="color:aliceblue; font-size: @Letra"></b></th>
                                    }
                                }
                            </tr>
                        </tbody>
                    </table>
                }
                else
                {
                    <h1 style="background-color: aliceblue; border: none; background-color:transparent; text-align:center"><b style="color:aliceblue;">NO HAY MOVIMIENTOS DE ESTE MES</b></h1>
                }
            }
        </div>

        <br />

        @*AQUI EMPIEZA LA TABLA DE DESGLOCE*@
        <div class="tablaScroll; hidden-print" style="min-height: 900px; min-width: 1000px">
            <table class="table  table-hover tablas" style="color: #000000">
                <thead style="color:white">
                    <tr>
                        <th>
                            Nombre
                        </th>
                        <th>
                            Sucursal
                        </th>
                        <th>
                            Referencia
                        </th>
                        <th>
                            ReferidoPor
                        </th>
                        <th>
                            Cuenta
                        </th>
                        <th>
                            TipoPago
                        </th>
                        <th>
                            FechaEjecución
                        </th>
                        <th>
                            FechaPago
                        </th>
                        <th>
                            Precio
                        </th>
                        <th>
                            Usuario
                        </th>
                    </tr>
                </thead>
                @{
                    foreach (var conc in modeloNormal)
                    {
                        <tr>
                            <td>
                                @conc.B.NombrePaciente
                            </td>
                            <td>
                                @conc.A.M.Sucursal
                            </td>
                            <td>
                                @conc.A.M.Referencia
                            </td>
                            <td>
                                @conc.A.M.ReferidoPor
                            </td>
                            <td>
                                @conc.A.M.Cuenta
                            </td>
                            <td>
                                @conc.A.M.TipoPago
                            </td>
                            <td>
                                @Convert.ToDateTime(conc.A.M.FechaCita).ToString("dd-MMMM-yy")
                            </td>
                            <td>
                                @{
                                    if (conc.A.M.Cuenta == "BANCOS" || conc.A.M.Cuenta == "CONEKTA")
                                    {
                                        <span>@Convert.ToDateTime(conc.A.M.FechaContable).ToString("dd-MMMM-yy")</span>
                                    }

                                    else
                                    {
                                        <span>---</span>
                                    }
                                }
                            </td>
                            <td>
                                $@Convert.ToDouble(conc.A.M.PrecioEpi).ToString("####.##")
                            </td>
                            <td>
                                @conc.A.M.Recepcionista
                            </td>
                        </tr>
                    }
                }
            </table>
        </div>
    }

    else if (canal == "IN SITU" || canal == "GESTOR ALT" && canal != null && canal != "" && referido != null && referido != "")
    {
        <div>
            <table cellpadding="0" cellspacing="0" class="table  table-hover tablas table-bordered" style="color: #2F2D6B">
                <thead style="color:white">
                    <tr>
                        <th style="background-color: gray;" colspan="2"></th>
                        <th style="background-color: gray; " colspan="3">Operaciones de @fechaInicio.ToString("MMMM")</th>
                        <th style="background-color: gray; " colspan="2"></th>
                    </tr>
                </thead>
                <tbody>
                    @{
                        var ultimaFecha = (from i in modeloAlternativo select i).OrderByDescending(o => o.FechaCita).FirstOrDefault();
                        DateTime fechadeultimoepi = FECHAI;
                        if (ultimaFecha != null)
                        {
                            fechadeultimoepi = Convert.ToDateTime(ultimaFecha.FechaCita);
                        }
                        var findidRef = (from i in db.Referido where i.Nombre == referido && i.Tipo == canal select i).FirstOrDefault();
                        var ultimaFechaPagos = (from i in pagosGestores where i.idReferido == findidRef.idReferido && i.Fecha >= fechaInicio && i.Fecha <= fechaFinal select i).OrderByDescending(o => o.Fecha).FirstOrDefault();
                        DateTime fechadeultimopago = FECHAI;
                        if (ultimaFechaPagos != null)
                        {
                            fechadeultimopago = Convert.ToDateTime(ultimaFechaPagos.Fecha);
                        }
                        var preciodesumasnofechas = 0;
                        var saldoRowAnterior = 0;

                        foreach (var item in modeloAlternativo.OrderBy(q => q.FechaCita))
                        {
                            //VARIABLES PARA FECHAS
                            fechaTabla = Convert.ToDateTime(item.FechaCita).ToString("dd-MMMM-yy");
                            var parseFechaInicial = DateTime.Parse(fechaTabla);
                            var parseFechaFinal = DateTime.Parse(fechaTabla).AddHours(23).AddMinutes(59);

                            //CONTEO DE EPIS TOTALES
                            int conteoEpisTotales = (from i in modeloAlternativo where i.FechaCita >= parseFechaInicial && i.FechaCita <= parseFechaFinal select i).Count();
                            var episXDia = (from i in modeloAlternativo where i.FechaCita >= parseFechaInicial && i.FechaCita <= parseFechaFinal select i);
                            var episXDiaP = (from i in modeloAlternativo where i.FechaCita >= parseFechaInicial && i.FechaCita <= parseFechaFinal && (i.Cuenta == "BANCOS" || i.Cuenta == "COMEKTA") select i);

                            //CONTEO DE EPIS TOTALES PAGADOS
                            int conteoEpisPTotales = (from i in modeloAlternativo where i.FechaCita >= parseFechaInicial && i.FechaCita <= parseFechaFinal && (i.Cuenta == "BANCOS" || i.Cuenta == "CONEKTA") select i).Count();

                            //VARIABLES PARA PAGOS EFECTUADOS EN MODULO DE PAGOS
                            var pagoGestor = (from i in pagosGestores where i.Gestor == item.ReferidoPor && i.Fecha >= parseFechaInicial && i.Fecha <= parseFechaFinal select i);
                            var referidoPagos = (from i in db.Referido where i.Nombre == item.ReferidoPor && i.Tipo == item.CanalTipo select i).FirstOrDefault();
                            var condicionante = "";
                            var pagodeRow = 0;

                            //VARIABLE PARA ROW DE PAGOS
                            if (fechaTablaAnterior != "")
                            {
                                var fechaRow = DateTime.Parse(fechaTablaAnterior).AddDays(1);
                                var pagoGestorRow = (from i in pagosGestores where i.Gestor == item.ReferidoPor && i.idReferido == referidoPagos.idReferido && i.Fecha >= fechaRow && i.Fecha <= parseFechaInicial select i).OrderBy(o => o.Fecha);
                                var pagoGestorRowCount = (from i in pagosGestores where i.Gestor == item.ReferidoPor && i.idReferido == referidoPagos.idReferido && i.Fecha >= fechaRow && i.Fecha <= parseFechaInicial select i).Count();

                                if (pagoGestorRowCount != 0)
                                {
                                    condicionante = "Si";

                                    foreach (var i in pagoGestorRow)
                                    {
                                        var getFecha = Convert.ToDateTime(i.Fecha).ToString("dd-MMMM-yy");
                                        fechaPagosRow = DateTime.Parse(getFecha);
                                        pagodeRow += Convert.ToInt32(i.PagoIngresado);
                                    }
                                }
                            }

                            //ROW DE PAGO SI ES DIFERENTE A FECHA TABLA PASADA

                            if (condicionante == "Si")
                            {
                                var comparacion = Convert.ToDateTime(fechaPagosRow).ToString("dd-MMMM-yy");

                                if (fechaTablaAnterior != comparacion)
                                {
                                        <tr style="height: auto">

                                            @*FECHA DE CITA*@
                                            <td>
                                                <span>@Convert.ToDateTime(fechaPagosRow).ToString("dd-MMMM-yy")</span>
                                            </td>

                                            @*NUMERO DE EPIS X DIA EN FECHA*@
                                            <td>
                                            </td>

                                            @*IMPORTE*@
                                            <td>
                                            </td>

                                            @*EPIS PAGADOS*@

                                            <td>
                                            </td>

                                            @*IMPORTE EPIS PAGADOS*@

                                            <td>
                                            </td>

                                            @*IMPORTE MODULO DE PAGOS*@
                                            <td>
                                                <span>$@pagodeRow.ToString("###,###,###,###")</span>
                                            </td>

                                            @*SALDOS*@
                                            @{
                                                saldoRowAnterior = saldoRowAnterior + pagodeRow;

                                                if (saldoRowAnterior < 0)
                                                {
                                                    var muestrasaldo = saldoRowAnterior * (-1);
                                                    <td>
                                                        <span>$(@muestrasaldo.ToString("###,###,###,###"))</span>
                                                    </td>
                                                }
                                                else
                                                { 
                                                    <td>
                                                        <span>$@saldoRowAnterior.ToString("###,###,###,###")</span>
                                                    </td>
                                                }                                                
                                            }
                                        </tr>

                                    montoPxDia = 0;
                                    montoPxDiaP = 0;
                                    precioVisual = 0;
                                    pagoVisual = 0;
                                    condicionante = "";
                                    totalPago += pagodeRow;
                                }
                            }


                            if (fechaTablaAnterior != fechaTabla)
                            {
                                totalEpis = (from i in modeloAlternativo select i).Count();

                                //SUMA DE PRECIOS EPIS X DIA
                                foreach (var precio in episXDia)
                                {
                                    montoPxDia += Convert.ToInt32(precio.PrecioEpi);
                                }

                                //SUMA DE PRECIOS PAGADOS EPIS X DIA
                                foreach (var precio in episXDiaP)
                                {
                                    montoPxDiaP += Convert.ToInt32(precio.PrecioEpi);
                                }

                                saldoTotalImporte += montoPxDia;
                                saldoTotalP += montoPxDiaP;
                                totalEpisP = (from i in modeloAlternativo where (i.Cuenta == "BANCOS" || i.Cuenta == "CONEKTA") select i).Count();

                                foreach (var pagos in pagoGestor)
                                {
                                    pagoVisual += Convert.ToInt32(pagos.PagoIngresado);
                                    fechadePago = Convert.ToDateTime(pagos.Fecha).ToString("dd-MMMM-yy");
                                }

                                totalPago += pagoVisual;
                                diferenciaTotal = saldoTotalImporte - (saldoTotalP + totalPago);

                                <tr style="height: auto">

                                    @*FECHA DE CITA*@
                                    <td>
                                        <span>@fechaTabla</span>
                                    </td>

                                    @*NUMERO DE EPIS X DIA EN FECHA*@
                                    @{
                                        var fechaTablaInicioDia = Convert.ToDateTime(fechaTabla);
                                        var fechaTablaFinalDia = Convert.ToDateTime(fechaTabla).AddMinutes(-1);
                                        <td>
                                            <div>
                                                <a class="hidden-print" href=@Url.Action("Index", "Contabilidad", new { canal = canal, fechaInicio = fechaTablaInicioDia, fechaFinal = fechaTablaFinalDia, referido = findidRef.idReferido }) style="color:navy; text-decoration:none">
                                                    <span>@conteoEpisTotales</span>
                                                </a>
                                                <span class="visible-print" hidden>@conteoEpisTotales</span>
                                            </div>
                                        </td>
                                    }

                                    @*IMPORTE*@
                                    <td>
                                        <span>$@montoPxDia.ToString("###,###,###,###")</span>
                                    </td>

                                    @*EPIS PAGADOS*@

                                    @{
                                        if (conteoEpisPTotales != 0)
                                        {
                                            <td>
                                                <span>@conteoEpisPTotales</span>
                                            </td>
                                        }
                                        else
                                        {
                                            <td>
                                            </td>
                                        }
                                    }

                                    @*IMPORTE EPIS PAGADOS*@

                                    @{
                                        if (conteoEpisPTotales != 0)
                                        {
                                            <td>
                                                <span>$@montoPxDiaP.ToString("###,###,###,###")</span>
                                            </td>
                                        }
                                        else
                                        {
                                            <td>
                                            </td>
                                        }
                                    }

                                    @*IMPORTE MODULO DE PAGOS*@

                                    @{
                                        if (fechaTabla == fechadePago)
                                        {
                                            <td>
                                                <span>$@pagoVisual.ToString("###,###,###,###")</span>
                                            </td>
                                        }
                                        else
                                        {
                                            <td>
                                            </td>
                                        }

                                    }

                                    @*SALDOS*@
                                    @{
                                        var sumaPositivos = montoPxDiaP + pagoVisual;
                                        var saldoensaldos = sumaPositivos - montoPxDia;

                                        if (saldoRowAnterior == 0)
                                        {
                                            saldoRowAnterior = saldoensaldos;
                                        }

                                        else if(saldoRowAnterior < 0)
                                        {
                                            if (saldoensaldos < 0)
                                            {
                                                saldoRowAnterior = saldoRowAnterior + saldoensaldos;
                                            }
                                            else
                                            {
                                                saldoRowAnterior = saldoRowAnterior + saldoensaldos;
                                            }
                                        }

                                        else
                                        {
                                            if(saldoensaldos < 0)
                                            {
                                                saldoRowAnterior = saldoRowAnterior + saldoensaldos;
                                            }
                                            else
                                            {
                                                saldoRowAnterior = saldoRowAnterior + saldoensaldos;
                                            }
                                        }

                                        if (saldoRowAnterior < 0)
                                        {
                                            var muestradesaldo = saldoRowAnterior * (-1);
                                                <td>
                                                    <span>$(@muestradesaldo.ToString("###,###,###,###"))</span>
                                                </td>
                                            }
                                            else
                                            {
                                                <td>
                                                    <span>$@saldoRowAnterior.ToString("###,###,###,###")</span>
                                                </td>
                                            }

                                            saldoensaldos = 0;
                                        }
                                </tr>

                                fechaTablaAnterior = fechaTabla;
                                montoPxDia = 0;
                                montoPxDiaP = 0;
                                precioVisual = 0;
                                pagoVisual = 0;
                            }
                        }

                        //ROW DE PAGO SI ES DIFERENTE A FECHA TABLA PASADA
                        var fechaUEPI = Convert.ToDateTime(fechadeultimoepi).ToString("dd-MMMM-yy");
                        DateTime fechaUEPI2 = Convert.ToDateTime(fechaUEPI);
                        var fechaUPAGO = Convert.ToDateTime(fechadeultimopago).ToString("dd-MMMM-yy");
                        DateTime fechaUPAGO2 = Convert.ToDateTime(fechaUPAGO);

                        if (fechaUEPI2 < fechaUPAGO2 )
                        {
                            var fechasDePagosjaja = (from i in pagosGestores where i.idReferido == findidRef.idReferido && i.Fecha > fechadeultimoepi && i.Fecha <= fechadeultimopago select i);

                            foreach (var i in fechasDePagosjaja)
                            {
                                preciodesumasnofechas += Convert.ToInt32(i.PagoIngresado);
                            }

                            <tr style="height: auto">

                                @*FECHA DE CITA*@
                                <td>
                                    <span>@Convert.ToDateTime(fechadeultimopago).ToString("dd-MMMM-yy")</span>
                                </td>

                                @*NUMERO DE EPIS X DIA EN FECHA*@
                                <td>
                                </td>
                                
                                @*IMPORTE*@
                                <td>
                                </td>

                                @*EPIS PAGADOS*@

                                <td>
                                </td>

                                @*IMPORTE EPIS PAGADOS*@

                                <td>
                                </td>

                                @*IMPORTE MODULO DE PAGOS*@
                                <td>
                                    <span>$@preciodesumasnofechas.ToString("###,###,###,###")</span>
                                </td>

                                @*SALDO*@
                                @{ 
                                    saldoRowAnterior = saldoRowAnterior + preciodesumasnofechas;

                                    if(saldoRowAnterior < 0)
                                    {
                                        var muestrasaldo = saldoRowAnterior * (-1);
                                        <td>
                                            <span>$(@muestrasaldo.ToString("###,###,###,###"))</span>
                                        </td>
                                    }
                                    else
                                    { 
                                        <td>
                                            <span>$@saldoRowAnterior.ToString("###,###,###,###")</span>
                                        </td>
                                    }                                
                                }
                            </tr>

                            totalPago += preciodesumasnofechas;
                            diferenciaTotal = saldoTotalImporte - (saldoTotalP + totalPago);
                            preciodesumasnofechas = 0;
                        }


                        <tr>

                            @*FECHA DE CITA*@
                            <td>
                            </td>

                            @*NUMERO DE EPIS X DIA EN FECHA*@
                            <td>
                            </td>

                            @*IMPORTE*@
                            <td>
                            </td>

                            @*EPIS PAGADOS*@
                            <td>
                            </td>

                            @*IMPORTE EPIS PAGADOS*@

                            <td>
                            </td>

                            @*IMPORTE MODULO DE PAGOS*@

                            <td>
                            </td>

                            @*SALDO*@

                            <td>
                            </td>

                        </tr>
                    }
                </tbody>
            </table>
            @{
                if (fechaTabla != null && fechaTabla != "")
                {
                    <table cellpadding="0" cellspacing="0" class="table  table-hover tablas table-bordered" style="background-color:transparent; border-color:transparent">
                        <thead style="border: none; background-color:transparent">
                            <tr style="border: none; background-color:transparent">

                                @*FOOTTER  MES ACTUAL*@
                                <th style="background-color: aliceblue; border: none; background-color:transparent"><b style="color:aliceblue; font-size: @Letra">@Convert.ToDateTime(fechaTabla).ToString("MMMM").ToUpper()</b></th>


                                @*FOOTTER  EPIS TOTALES*@
                                <th style="background-color: aliceblue; border: none; background-color:transparent"><b style="color:aliceblue; font-size: @Letra">@totalEpis</b></th>


                                @*FOOTTER  IMPORTE TOTAL*@
                                <th style="background-color: aliceblue; border: none; background-color:transparent"><b style="color:aliceblue; font-size: @Letra">$@saldoTotalImporte.ToString("###,###,###,###")</b></th>


                                @*FOOTTER  EPIS CONCILIADOS TOTALES*@
                                @{
                                    if (totalEpisP != 0)
                                    {
                                        <th style="background-color: aliceblue; border: none; background-color:transparent"><b style="color:aliceblue; font-size: @Letra">@totalEpisP</b></th>
                                    }
                                    else
                                    {
                                        <th style="background-color: aliceblue; border: none; background-color:transparent"><b style="color:aliceblue; font-size: @Letra"></b></th>
                                    }
                                }

                                @*FOOTTER IMPORTE DE  EPIS CONCILIADOS TOTALES*@
                                @{
                                    if (saldoTotalP != 0)
                                    {
                                        <th style="background-color: aliceblue; border: none; background-color:transparent"><b style="color:aliceblue; font-size: @Letra">$@saldoTotalP.ToString("###,###,###,###")</b></th>
                                    }
                                    else
                                    {
                                        <th style="background-color: aliceblue; border: none; background-color:transparent"><b style="color:aliceblue; font-size: @Letra"></b></th>
                                    }
                                }

                                @*FOOTTER  PAGOS INGRESADOS TOTALES*@
                                @{
                                    if (totalPago != 0)
                                    {
                                        <th style="background-color: aliceblue; border: none; background-color:transparent"><b style="color:aliceblue; font-size:@Letra">$@totalPago.ToString("###,###,###,###")</b></th>
                                    }
                                    else
                                    {
                                        <th style="background-color: aliceblue; border: none; background-color:transparent"><b style="color:aliceblue; font-size: @Letra"></b></th>
                                    }
                                }

                                @*FOOTTER  DIFERENCIA DE PAGOS*@
                                @{
                                    if (diferenciaTotal != 0)
                                    {
                                        if (diferenciaTotal > 0)
                                        {
                                            <th style="background-color: aliceblue; border: none; background-color:transparent"><b style="color:aliceblue; font-size:@Letra">($@diferenciaTotal.ToString("###,###,###,###"))</b></th>
                                        }
                                        else if (diferenciaTotal < 0)
                                        {
                                            diferenciaTotal = diferenciaTotal * (-1);
                                            <th style="background-color: aliceblue; border: none; background-color:transparent"><b style="color:aliceblue; font-size:@Letra">$@diferenciaTotal.ToString("###,###,###,###")</b></th>
                                        }
                                    }
                                    else
                                    {
                                        <th style="background-color: aliceblue; border: none; background-color:transparent"><b style="color:aliceblue; font-size: @Letra"></b></th>
                                    }
                                }
                            </tr>
                        </thead>

                        @*DIFERENCIAS DE MES*@
                        <tbody>
                            <tr style="border: none; background-color:transparent">

                                @*FOOTTER  MES PASADO*@
                                <th style="background-color: aliceblue; border: none; background-color:transparent"><b style="color:aliceblue; font-size: @Letra">Sumas:</b></th>


                                @*FOOTTER  EPIS TOTALES PASADO*@

                                @{var finalTotal = totalEpis + totalEpisMA;
                                    <th style="background-color: aliceblue; border: none; background-color:transparent"><b style="color:aliceblue; font-size: @Letra">@finalTotal</b></th>
                                }

                                @*FOOTTER  IMPORTE TOTAL PASADO*@

                                @{var importeTotal = saldoTotalImporte + saldoTotalImporteMA;
                                    <th style="background-color: aliceblue; border: none; background-color:transparent"><b style="color:aliceblue; font-size: @Letra">$@importeTotal.ToString("###,###,###,###")</b></th>
                                }

                                @*FOOTTER  EPIS CONCILIADOS TOTALES PASADO*@
                                @{var episPTotales = totalEpisP + totalEpisPMA;
                                    if (totalEpisP != 0)
                                    {
                                        <th style="background-color: aliceblue; border: none; background-color:transparent"><b style="color:aliceblue; font-size: @Letra">@episPTotales</b></th>
                                    }
                                    else
                                    {
                                        <th style="background-color: aliceblue; border: none; background-color:transparent"><b style="color:aliceblue; font-size: @Letra"></b></th>
                                    }
                                }

                                @*FOOTTER IMPORTE DE  EPIS CONCILIADOS TOTALES PASADO*@
                                @{
                                    var totalPagado = saldoTotalP + montoTotalMaP;
                                    if (saldoTotalP != 0)
                                    {
                                        <th style="background-color: aliceblue; border: none; background-color:transparent"><b style="color:aliceblue; font-size: @Letra">$@totalPagado.ToString("###,###,###,###")</b></th>
                                    }
                                    else
                                    {
                                        <th style="background-color: aliceblue; border: none; background-color:transparent"><b style="color:aliceblue; font-size: @Letra"></b></th>
                                    }
                                }

                                @*FOOTTER  PAGOS INGRESADOS TOTALES PASADO*@
                                @{
                                    if (totalPago != 0)
                                    {
                                        <th style="background-color: aliceblue; border: none; background-color:transparent"><b style="color:aliceblue; font-size:@Letra">$@totalPago.ToString("###,###,###,###")</b></th>
                                    }
                                    else
                                    {
                                        <th style="background-color: aliceblue; border: none; background-color:transparent"><b style="color:aliceblue; font-size: @Letra"></b></th>
                                    }
                                }

                                @*FOOTTER  DIFERENCIA DE PAGOS PASADO*@
                                @{
                                    if (diferenciaTotal != 0)
                                    {
                                        if (diferenciaTotal < 0)
                                        {
                                            diferenciaTotal = diferenciaTotal * (-1);
                                            <th style="background-color: aliceblue; border: none; background-color:transparent"><b style="color:aliceblue; font-size:@Letra">($@diferenciaTotal.ToString("###,###,###,###"))</b></th>
                                        }
                                        else if (diferenciaTotal < 0)
                                        {
                                            <th style="background-color: aliceblue; border: none; background-color:transparent"><b style="color:aliceblue; font-size:@Letra">$@diferenciaTotal.ToString("###,###,###,###")</b></th>
                                        }
                                    }
                                    else
                                    {
                                        <th style="background-color: aliceblue; border: none; background-color:transparent"><b style="color:aliceblue; font-size: @Letra"></b></th>
                                    }
                                }
                            </tr>
                        </tbody>
                    </table>
                }
                else
                {
                    <h1 style="background-color: aliceblue; border: none; background-color:transparent; text-align:center"><b style="color:aliceblue;">NO HAY MOVIMIENTOS EN ESTE RANGO DE FECHA</b></h1>
                }
            }
        </div>
        <br />

        @*AQUI EMPIEZA LA TABLA DE DESGLOCE*@
        <div class="tablaScroll" style="min-height: 900px; min-width: 1000px">
            <table class="table  table-hover tablas" style="color: #000000">
                <thead style="color:white">
                    <tr>
                        <th>
                            Nombre
                        </th>
                        <th>
                            ReferidoPor
                        </th>
                        <th>
                            Cuenta
                        </th>
                        <th>
                            TipoPago
                        </th>
                        <th>
                            FechaEjecución
                        </th>
                        <th>
                            FechaPago
                        </th>
                        <th>
                            Precio
                        </th>
                        <th>
                            Usuario
                        </th>
                    </tr>
                </thead>
                @{
                    foreach (var conc in modeloAlternativo)
                    {
                        <tr>
                            <td>
                                @conc.Nombre
                            </td>
                            <td>
                                @conc.ReferidoPor
                            </td>
                            <td>
                                @conc.Cuenta
                            </td>
                            <td>
                                @conc.TipoPago
                            </td>
                            <td>
                                @Convert.ToDateTime(conc.FechaCita).ToString("dd-MMMM-yy")
                            </td>
                            <td>
                                @{
                                    if (conc.Cuenta == "BANCOS" || conc.Cuenta == "CONEKTA")
                                    {
                                        <span>@Convert.ToDateTime(conc.FechaContable).ToString("dd-MMMM-yy")</span>
                                    }

                                    else
                                    {
                                        <span>---</span>
                                    }
                                }
                            </td>
                            <td>
                                $@Convert.ToDouble(conc.PrecioEpi).ToString("####.##")
                            </td>
                            <td>
                                @conc.Usuario
                            </td>
                        </tr>
                    }
                }
            </table>
        </div>
    }
}